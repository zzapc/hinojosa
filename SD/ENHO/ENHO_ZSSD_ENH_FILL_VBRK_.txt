<?xml version="1.0" encoding="utf-8"?> <ENHO enhancement_id="ZSSD_ENH_FILL_VBRK" shorttext="Rellenar tipo factura para autofactura" tooltype_id="HOOK_IMPL" orig_object="R3TR-V60A-FUGR-SAPLV60A">  <asx:abap xmlns:asx="http://www.sap.com/abapxml" version="1
.0">   <asx:values>    <IMPLS>     <ENH_HOOK_IMPL>      <SPOTNAME/>      <PROGRAMNAME>SAPLV60A</PROGRAMNAME>      <EXTID>1</EXTID>      <ID>1</ID>      <OVERWRITE/>      <METHOD/>      <ENHMODE>D</ENHMODE>      <FULL_NAME>\PR:SAPLV60A\FO:USEREXIT_FILL_VBR
K_VBRP\SE:END\EI</FULL_NAME>      <SOURCE>       <item>*</item>       <item/>       <item>DATA: l_check_t TYPE flag.</item>       <item/>       <item>CLEAR: l_check_t.</item>       <item/>       <item>SELECT SINGLE zzautofactura INTO @DATA(l_auto) FROM kn
vv</item>       <item>WHERE kunnr = @VBRK-kunag</item>       <item>AND vkorg = @VBRK-vkorg</item>       <item>AND vtweg = @VBRK-vtweg</item>       <item>AND spart = @VBRK-spart.</item>       <item/>       <item/>       <item>SELECT * INTO TABLE @DATA(t_au
tof) FROM zssdt000_autof.</item>       <item>*        If xvbrp[] IS INITIAL.</item>       <item/>       <item>SELECT auart INTO TABLE @DATA(t_auart)</item>       <item>FROM vbap as a</item>       <item>INNER JOIN vbak as c on a~vbeln = c~vbeln</item>
  <item>WHERE a~vbeln = @vbrp-vbeln</item>       <item>AND a~posnr = @vbrp-posnr.</item>       <item/>       <item/>       <item>*        ELSE.</item>       <item>*</item>       <item>*          SELECT auart INTO TABLE @t_auart</item>       <item>*
   FROM lips AS b</item>       <item>*          INNER JOIN vbak AS c ON b~vgbel = c~vbeln</item>       <item>*          FOR ALL ENTRIES IN @xvbrp</item>       <item>*          WHERE b~vbeln = @xvbrp-vgbel</item>       <item>*            AND b~posnr = @xvb
rp-vgpos.</item>       <item>*            If sy-subrc &lt;&gt; 0.</item>       <item>*              SELECT auart INTO TABLE @t_auart</item>       <item>*                FROM vbap as a</item>       <item>*                INNER JOIN vbak as c on a~vbeln = c
~vbeln</item>       <item>*                FOR ALL ENTRIES IN @xvbrp</item>       <item>*              WHERE a~vbeln = @xvbrp-vgbel</item>       <item>*                AND a~posnr = @xvbrp-vgpos.</item>       <item>*</item>       <item>*            ENDIF.
</item>       <item/>       <item>*        ENDIf.</item>       <item/>       <item>READ TABLE t_auart INTO DATA(l_auart) index 1.</item>       <item/>       <item/>       <item>READ TABLE t_autof into DATA(l_autof) WITH KEY zzautofactura = l_auto auart =
l_auart-auart.</item>       <item>If sy-subrc = 0.</item>       <item>vbrk-fkart = l_autof-fkart.</item>       <item>ENDIF.</item>       <item/>       <item>*INI JGM 25.01.2024 GAPSD044 Facturas de exportación - Clase Factura ZF3:</item>       <item>&quot
;Si el cliente es Facturas Exportación (KNVV-KVGR4 = &apos;C05&apos;), la clase</item>       <item>&quot;de la factura a crear se debe cambiar a: ZF3 &quot;Factura inmediata&quot;.</item>       <item/>       <item>DATA: lv_fkart TYPE vbrk-fkart.</item>
    <item/>       <item>IF sy-tcode EQ &apos;VF01&apos; OR sy-tcode EQ &apos;VF04&apos;.</item>       <item>CLEAR lv_fkart.</item>       <item>CALL FUNCTION &apos;Z_SSD_CLIENTE_EXPORTACION&apos;</item>       <item>EXPORTING</item>       <item>i_kunnr = vb
rk-kunag</item>       <item>i_vkorg = vbrk-vkorg</item>       <item>i_vtweg = vbrk-vtweg</item>       <item>i_spart = vbrk-spart</item>       <item>i_fkart = vbrk-fkart</item>       <item>IMPORTING</item>       <item>*          e_kvgr4 =</item>       <ite
m>*          e_faksk =</item>       <item>e_fkart = lv_fkart.</item>       <item/>       <item>IF lv_fkart IS NOT INITIAL.</item>       <item>vbrk-fkart = lv_fkart.</item>       <item>ENDIF.</item>       <item>ENDIF.</item>       <item>*FIN JGM 25.01.2024
 GAPSD044.</item>       <item/>       <item>&quot;EMP: 13.02.24 GAPSD045</item>       <item/>       <item>&quot;DFS: 08.01.25 Condicionar para que solo aplique en facturación de entregas a cliente LIKP-VBTYP = &apos;J&apos;</item>       <item>IF LIKP-VBTY
P =&apos;J&apos;.</item>       <item>SELECT SINGLE kvgr4</item>       <item>INTO @DATA(l_kvgr4)</item>       <item>FROM knvv</item>       <item>WHERE kunnr EQ @vbrk-kunag</item>       <item>AND vkorg EQ @vbrk-vkorg</item>       <item>AND vtweg EQ @vbrk-vt
weg</item>       <item>AND spart EQ @vbrk-spart.</item>       <item>IF sy-subrc = 0 AND l_kvgr4 = &apos;C04&apos;.</item>       <item>vbrk-fkart = &apos;ZF3&apos;.</item>       <item>ENDIF.</item>       <item>ENDIF.</item>       <item>&quot;FIN DFS: 01.01
.25 Ajuste condicionamiento.</item>       <item>&quot;FIN EMP: 13.02.24 GAPSD045</item>       <item/>      </SOURCE>      <PARENT_FULL_NAME/>     </ENH_HOOK_IMPL>    </IMPLS>   </asx:values>  </asx:abap> </ENHO>
