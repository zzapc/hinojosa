<?xml version="1.0" encoding="utf-8"?> <ENHO enhancement_id="ZSSD044_ENH_NUMBER_RANGE" shorttext="Ampliación GAPSD044 Chequear texto cabecera obligatorio" tooltype_id="HOOK_IMPL" orig_object="R3TR-V60A-FUGR-SAPLV60A">  <asx:abap xmlns:asx="http://www.sap.
com/abapxml" version="1.0">   <asx:values>    <IMPLS>     <ENH_HOOK_IMPL>      <SPOTNAME/>      <PROGRAMNAME>SAPLV60A</PROGRAMNAME>      <EXTID>1</EXTID>      <ID>1</ID>      <OVERWRITE/>      <METHOD/>      <ENHMODE>D</ENHMODE>      <FULL_NAME>\PR:SAPLV6
0A\FO:USEREXIT_NUMBER_RANGE\SE:END\EI</FULL_NAME>      <SOURCE>       <item/>       <item>*INI JGM 25.01.2024 GAPSD044 Facturas de exportación - Texto cabecera factura obligatorio:</item>       <item>&quot;Si el cliente es Facturas Exportación (KNVV-KVGR4
 = &apos;C05&apos;), el texto de cabecera</item>       <item>&quot;ZFC3 &quot;Texto exportaciones&quot; deberá ser obligatorio.</item>       <item/>       <item>IF sy-tcode EQ &apos;VF01&apos; AND sy-ucomm EQ &apos;SICH&apos; AND vbrk-fkart = &apos;ZF3&ap
os;.</item>       <item>CONSTANTS: lc_zfc3 TYPE TDID VALUE &apos;ZFC3&apos;. &quot;ID Texto Exportaciones -cabecera-.</item>       <item>DATA lv_kvgr4 TYPE kvgr4.</item>       <item/>       <item>CALL FUNCTION &apos;Z_SSD_CLIENTE_EXPORTACION&apos;</item>
      <item>EXPORTING</item>       <item>i_kunnr = vbrk-kunag</item>       <item>i_vkorg = vbrk-vkorg</item>       <item>i_vtweg = vbrk-vtweg</item>       <item>i_spart = vbrk-spart</item>       <item>IMPORTING</item>       <item>e_kvgr4 = lv_kvgr4.</item
>       <item>*      E_FAKSK       =</item>       <item>*      E_FKART       =.</item>       <item/>       <item>IF lv_kvgr4 IS NOT INITIAL.</item>       <item>IF line_exists( xthead[ tdid = lc_zfc3 updkz = &apos;I&apos; ] )  &quot;Texto nuevo insertado e
n pantalla.</item>       <item>OR</item>       <item>line_exists( xthead[ tdid = lc_zfc3 updkz = &apos;U&apos; ] )  &quot;Texto modificado en pantalla.</item>       <item>OR</item>       <item>line_exists( xthead[ tdid = lc_zfc3 tdrefid = lc_zfc3 ] ). &qu
ot;Texto de referencia del maestro.</item>       <item/>       <item>&quot;Cuando en XTHEAD está el registro indicando texto insertado, en ciertos casos según como el usuario</item>       <item>&quot;salga de la caja de texto, a veces queda registrado dos
 veces el mismo TDID, uno del insert y otro</item>       <item>&quot;vacío, entonces hay que verificar que realmente hay texto introducido, aunque aparezca como insertado.</item>       <item/>       <item>DATA lt_lines TYPE TABLE OF tline.</item>       <i
tem/>       <item>TRY .</item>       <item>DATA(wa_xthead) = xthead[ tdid = lc_zfc3 updkz = &apos;I&apos; ].</item>       <item>CATCH cx_root.</item>       <item>TRY.</item>       <item>wa_xthead = xthead[ tdid = lc_zfc3 updkz = &apos;U&apos; ].</item>
    <item>CATCH cx_root.</item>       <item>wa_xthead = xthead[ tdid = lc_zfc3 tdrefid = lc_zfc3 ].</item>       <item>ENDTRY.</item>       <item>ENDTRY.</item>       <item/>       <item>IF wa_xthead IS NOT INITIAL.</item>       <item>CALL FUNCTION &apos;
READ_TEXT&apos;</item>       <item>EXPORTING</item>       <item>id                            = wa_xthead-tdid</item>       <item>language                      = wa_xthead-tdspras</item>       <item>NAME                          = wa_xthead-tdname</item>
      <item>OBJECT                        = wa_xthead-tdobject</item>       <item>TABLES</item>       <item>lines                         = lt_lines</item>       <item>EXCEPTIONS</item>       <item>ID                            = 1</item>       <item>LANG
UAGE                      = 2</item>       <item>NAME                          = 3</item>       <item>NOT_FOUND                     = 4</item>       <item>OBJECT                        = 5</item>       <item>REFERENCE_CHECK               = 6</item>
<item>WRONG_ACCESS_TO_ARCHIVE       = 7</item>       <item>OTHERS                        = 8.</item>       <item/>       <item>IF sy-subrc EQ 0.</item>       <item>&quot;No solo es revisar si hay líneas de texto, sino que no estén vacías.</item>       <it
em>LOOP AT lt_lines TRANSPORTING NO FIELDS WHERE tdline IS NOT INITIAL.</item>       <item>EXIT.</item>       <item>ENDLOOP.</item>       <item>IF sy-subrc NE 0.</item>       <item>&quot;Añadir error al log de transacción.</item>       <item>PERFORM vbfs_
hinzufuegen_allg USING vbrk-vbeln space &apos;ZSSD044&apos; &apos;E&apos; &apos;001&apos;</item>       <item>space space space space.</item>       <item>&quot;El texto de cabecera &quot;Texto exportaciones&quot; es obligatorio.&quot;</item>       <item>ME
SSAGE e001(ZSSD044).</item>       <item>ENDIF.</item>       <item>ELSE.</item>       <item>&quot;Añadir error al log de transacción.</item>       <item>PERFORM vbfs_hinzufuegen_allg USING vbrk-vbeln space &apos;ZSSD044&apos; &apos;E&apos; &apos;001&apos;<
/item>       <item>space space space space.</item>       <item>&quot;El texto de cabecera &quot;Texto exportaciones&quot; es obligatorio.&quot;</item>       <item>MESSAGE e001(ZSSD044).</item>       <item>ENDIF.</item>       <item>ENDIF.</item>       <ite
m/>       <item>ELSE.</item>       <item>&quot;Añadir error al log de transacción.</item>       <item>PERFORM vbfs_hinzufuegen_allg USING vbrk-vbeln space &apos;ZSSD044&apos; &apos;E&apos; &apos;001&apos;</item>       <item>space space space space.</item>
       <item>&quot;El texto de cabecera &quot;Texto exportaciones&quot; es obligatorio.&quot;</item>       <item>MESSAGE e001(ZSSD044).</item>       <item>ENDIF.</item>       <item>ENDIF.</item>       <item/>       <item>ENDIF.</item>       <item>*FIN JGM
 25.01.2024 GAPSD044.</item>       <item/>      </SOURCE>      <PARENT_FULL_NAME/>     </ENH_HOOK_IMPL>    </IMPLS>   </asx:values>  </asx:abap> </ENHO>
