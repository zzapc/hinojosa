*&---------------------------------------------------------------------*
*& Report ZSLA_SV349_2
*&
*&---------------------------------------------------------------------*
*& Detects SAP notes to be adjusted for a maintenance dialog
*& Start the report
*& Enter the object
*& Execute the report
*& Follow the instruction
*&---------------------------------------------------------------------*
REPORT ZSLA_SV349_2.
DATA SMODILOG_TABLE TYPE STANDARD TABLE OF SMODILOG.
DATA SMODILOG_ROW LIKE SMODILOG.
DATA BEGIN OF AREA_DEVCLASS.
DATA AREA LIKE TVDIR-AREA.
DATA DEVCLASS LIKE TVDIR-DEVCLASS.
DATA END OF AREA_DEVCLASS.
DATA CWBNTHEAD_TABLE TYPE STANDARD TABLE OF CWBNTHEAD.
DATA BEGIN OF NOTE_VERSION.
DATA NOTE LIKE CWBNTHEAD-NUMM.
DATA VERSION LIKE CWBNTHEAD-VERSNO.
DATA END OF NOTE_VERSION.
DATA NOTE_VERSION_TABLE LIKE STANDARD TABLE OF NOTE_VERSION.
PARAMETERS TABNAME LIKE TVDIR-TABNAME.
SELECT SINGLE AREA DEVCLASS FROM TVDIR INTO AREA_DEVCLASS
WHERE TABNAME = TABNAME .
IF SY-SUBRC <> 0.
  WRITE 'Object does not exist'.
  EXIT.
ENDIF.
SELECT * FROM SMODILOG APPENDING TABLE SMODILOG_TABLE
WHERE OBJ_TYPE = 'FUGR'
AND OBJ_NAME = AREA_DEVCLASS-AREA
AND ACTIVE = 'U'.
IF SY-SUBRC <> 0.
  WRITE 'No data where selected'.
  EXIT.
ENDIF.
WRITE 'Perform these steps to solve the issue:' INTENSIFIED OFF.
NEW-LINE.
WRITE 'Start transaction' INTENSIFIED ON.
WRITE 'SPAU' INTENSIFIED OFF.
NEW-LINE.
WRITE: 'In field Package enter the value'
INTENSIFIED ON.
WRITE AREA_DEVCLASS-DEVCLASS INTENSIFIED OFF.
NEW-LINE.
WRITE 'Execute the report with icon' INTENSIFIED ON.
WRITE 'Execute (F8)' INTENSIFIED OFF.
NEW-LINE.
WRITE 'Expand tree' INTENSIFIED ON.
WRITE 'Note Corrections' INTENSIFIED OFF.
NEW-LINE.
WRITE 'Adjust the following SAP Notes with Reset to original:'.
NEW-LINE.
SORT SMODILOG_TABLE BY MOD_NAME.
DELETE ADJACENT DUPLICATES FROM SMODILOG_TABLE COMPARING MOD_NAME.
LOOP AT SMODILOG_TABLE INTO SMODILOG_ROW
WHERE OPERATION = 'NOTE'.
  NOTE_VERSION-NOTE = SMODILOG_ROW-MOD_NAME(10).
  NOTE_VERSION-VERSION = SMODILOG_ROW-MOD_NAME+10(4).
  APPEND NOTE_VERSION TO NOTE_VERSION_TABLE.
  WRITE SMODILOG_ROW-MOD_NAME(10) INTENSIFIED OFF.
  NEW-LINE.
ENDLOOP.
FREE NOTE_VERSION.
SELECT * FROM CWBNTHEAD APPENDING TABLE CWBNTHEAD_TABLE
  FOR ALL ENTRIES IN NOTE_VERSION_TABLE
  WHERE NUMM = NOTE_VERSION_TABLE-NOTE
  AND VERSNO = NOTE_VERSION_TABLE-VERSION.
IF SY-SUBRC <> 0.
  WRITE: 'PLEASE NOTE:',
         'SAP Note version does not exist, please read and use'
         INTENSIFIED OFF,
         'SAP note'
         INTENSIFIED ON,
         '702436'
         INTENSIFIED OFF,
         '- SAP Note not available in SPAU adjustment'.
ENDIF.
