<?xml version="1.0" encoding="utf-8"?> <ENHO enhancement_id="ZENH_ADD_CUSTOMER_FIELDS" shorttext="VL10: Añadir campos de cliente" tooltype_id="HOOK_IMPL" orig_object="R3TR-V50R_VIEW-FUGR-SAPLV50R_VIEW">  <asx:abap xmlns:asx="http://www.sap.com/abapxml" ve
rsion="1.0">   <asx:values>    <IMPLS>     <ENH_HOOK_IMPL>      <SPOTNAME/>      <PROGRAMNAME>SAPLV50R_VIEW</PROGRAMNAME>      <EXTID>1</EXTID>      <ID>1</ID>      <OVERWRITE/>      <METHOD/>      <ENHMODE>D</ENHMODE>      <FULL_NAME>\PR:SAPLV50R_VIEW\FO
:POS_ITEM_FILL_USER\SE:END\EI</FULL_NAME>      <SOURCE>       <item/>       <item>**********************************************************************</item>       <item>* Parámetros locales</item>       <item>*******************************************
***************************</item>       <item/>       <item>**********************************************************************</item>       <item>* Lógica</item>       <item>**********************************************************************</item
>       <item/>       <item>****** GET/SET PAPER DATA</item>       <item/>       <item>CALL FUNCTION &apos;ZFM_SD_GET_PAP_CDATA&apos;</item>       <item>EXPORTING</item>       <item>i_t_vbadr_we          = it_vbadr_we</item>       <item>CHANGING</item>
    <item>c_shp_vl10_item       = cs_postab.</item>       <item/>       <item>****** GET/SET FOLDING DATA</item>       <item/>       <item>CALL FUNCTION &apos;ZFM_SD_GET_FOL_CDATA&apos;</item>       <item>EXPORTING</item>       <item>i_t_vbadr_we
 = it_vbadr_we</item>       <item>CHANGING</item>       <item>c_shp_vl10_item       = cs_postab.</item>       <item/>       <item>**********************************************************************</item>       <item>* Parámetros locales</item>       <
item>**********************************************************************</item>       <item/>       <item>** Añadir campos de cliente:</item>       <item>*  DATA: lt_mchb TYPE TABLE OF MCHB,</item>       <item>*        ls_mchb type mchb.</item>       <
item>*</item>       <item>*  DATA: lv_object            TYPE objnum,</item>       <item>*        lt_alloc_values_num  TYPE tt_bapi1003_alloc_values_num,</item>       <item>*        lt_alloc_values_char TYPE tt_bapi1003_alloc_values_char,</item>       <ite
m>*        lt_alloc_values_curr TYPE tt_bapi1003_alloc_values_curr,</item>       <item>*        ls_alloc_values_num  TYPE bapi1003_alloc_values_num,</item>       <item>*        lt_return            TYPE bapiret2_tab,</item>       <item>*        ls_alloc_v
alues_char TYPE bapi1003_alloc_values_char.</item>       <item>*</item>       <item>*</item>       <item>*  DATA: ls_shipment_cdata TYPE zshipment_s_data.</item>       <item>*</item>       <item>************************************************************
**********</item>       <item>* Lógica</item>       <item>**********************************************************************</item>       <item>*</item>       <item>*  CLEAR: lt_mchb, lv_object, ls_alloc_values_char, lt_alloc_values_num, lt_alloc_valu
es_char.</item>       <item>*  CLEAR: lt_alloc_values_curr, lt_return.</item>       <item>*  REFRESH: lt_mchb, lt_alloc_values_num, lt_alloc_values_char, lt_alloc_values_curr, lt_return.</item>       <item>*  CLEAR: cs_postab-zzstock_papelera, cs_postab-z
zmeins.</item>       <item>*</item>       <item>****** --&gt; FCC 80366 - Nuevos campos VL10 PAP</item>       <item>*</item>       <item>* &quot;&quot;&quot;&quot; Comento por nueva lógica</item>       <item>*</item>       <item>*  SELECT * INTO TABLE lt_
mchb</item>       <item>*    FROM mchb</item>       <item>*    WHERE matnr = cs_postab-matnr</item>       <item>*    AND werks = cs_postab-vstel</item>       <item>*    AND clabs &lt;&gt; 0.</item>       <item>*</item>       <item>*  IF lt_mchb[] IS NOT I
NITIAL.</item>       <item>*    LOOP AT lt_mchb into ls_mchb.</item>       <item>*      CLEAR lv_object.</item>       <item>*      CONCATENATE ls_mchb-matnr ls_mchb-charg INTO lv_object RESPECTING BLANKS.</item>       <item>*</item>       <item>*      CAL
L FUNCTION &apos;BAPI_OBJCL_GETDETAIL&apos;</item>       <item>*      EXPORTING</item>       <item>*        objectkey       = lv_object</item>       <item>*        objecttable     = &apos;MCH1&apos;</item>       <item>*        classnum        = &apos;Z_BO
BINA&apos;</item>       <item>*        classtype       = &apos;023&apos;</item>       <item>**       KEYDATE         = SY-DATUM</item>       <item>**       UNVALUATED_CHARS       = &apos; &apos;</item>       <item>**       LANGUAGE        = SY-LANGU</item
>       <item>**     IMPORTING</item>       <item>**       STATUS          =</item>       <item>**       STANDARDCLASS   =</item>       <item>*      TABLES</item>       <item>*        allocvaluesnum  = lt_alloc_values_num</item>       <item>*        alloc
valueschar = lt_alloc_values_char</item>       <item>*        allocvaluescurr = lt_alloc_values_curr</item>       <item>*        return          = lt_return</item>       <item>*      EXCEPTIONS</item>       <item>*        ERROR_MESSAGE = 1</item>       <i
tem>*        OTHERS        = 2.</item>       <item>*      check sy-subrc = 0.</item>       <item>*</item>       <item>*</item>       <item>*</item>       <item>*    &quot; Chequeo Decisión de empleo:</item>       <item>*    CLEAR ls_alloc_values_char.</it
em>       <item>*    READ TABLE lt_alloc_values_char INTO ls_alloc_values_char</item>       <item>*             WITH KEY charact = &apos;LOBM_UDCODE&apos;.</item>       <item>*    IF ls_alloc_values_char-value_neutral &lt;&gt; &apos;DE       A&apos;.</ite
m>       <item>*      CONTINUE.</item>       <item>*    ENDIF.</item>       <item>*</item>       <item>*    &quot; Chequeo por cliente:</item>       <item>*    CLEAR ls_alloc_values_char.</item>       <item>*    READ TABLE lt_alloc_values_char INTO ls_all
oc_values_char</item>       <item>*             WITH KEY charact = &apos;Z_CLIENTE&apos;.</item>       <item>*    IF ls_alloc_values_char-value_neutral &lt;&gt; cs_postab-kunnr.</item>       <item>*      CONTINUE.</item>       <item>*    ENDIF.</item>
   <item>*</item>       <item>*    cs_postab-zzstock_papelera = cs_postab-zzstock_papelera + ls_mchb-clabs.</item>       <item>*    IF cs_postab-zzmeins is initial.</item>       <item>*    select single meins into cs_postab-zzmeins</item>       <item>*
   from mara</item>       <item>*      where matnr = cs_postab-matnr.</item>       <item>*    ENDIF.</item>       <item>*</item>       <item>*    ENDLOOP.</item>       <item>*  ENDIF.</item>       <item>*</item>       <item>** Rellenamos los campos:</item
>       <item>**  •ZZSTRAS: Direccion (elemento de datos STRAS).</item>       <item>**  •ZZLAND1: Pais (elemento de datos LAND1).</item>       <item>**  •ZZPSTLZ: Código Postal (elemento de datos PSTLZ).</item>       <item>**  •ZZORT01: Población (element
o de datos ORT01).</item>       <item>*  data: wa_VBADR type line of SHP_VL10_VBADR_T.</item>       <item>*</item>       <item>*  read table IT_VBADR_WE into wa_VBADR index 1.</item>       <item>*</item>       <item>*  cs_postab-ZZSTRAS = wa_VBADR-STRAS.<
/item>       <item>*  cs_postab-ZZLAND1 = wa_VBADR-LAND1.</item>       <item>*  cs_postab-ZZPSTLZ = wa_VBADR-PSTLZ.</item>       <item>*  cs_postab-ZZORT01 = wa_VBADR-ORT01.</item>       <item>*</item>       <item>*  CALL FUNCTION &apos;ZFM_SD_GET_PAP_CDA
TA&apos;</item>       <item>*    EXPORTING</item>       <item>*      i_t_vbadr_we          = it_vbadr_we</item>       <item>*    changing</item>       <item>*      c_shp_vl10_item       = cs_postab.</item>       <item>*</item>       <item>****** &lt;-- FC
C 80366 - Nuevos campos VL10 PAP</item>       <item>*</item>       <item>**********************************************************************</item>       <item>* INI GAPSD021 - Campos Z VL10C Packaging</item>       <item>*******************************
***************************************</item>       <item>*</item>       <item>*  CLEAR: ls_shipment_cdata.</item>       <item>*</item>       <item>**** Chequeos</item>       <item>*</item>       <item>**** Obtenemos datos</item>       <item>*</item>
   <item>*  CALL FUNCTION &apos;ZFM_SD_GET_SHP_CDATA&apos;</item>       <item>*    EXPORTING</item>       <item>*      i_vbeln                 = cs_postab-vbelv</item>       <item>*      i_posnr                 = cs_postab-posnv</item>       <item>*    IM
PORTING</item>       <item>*      e_shipment_s_data       = ls_shipment_cdata</item>       <item>*    exceptions</item>       <item>*      no_valid_iparams        = 1</item>       <item>*      no_valid_itype          = 2</item>       <item>*      OTHERS
                = 3.</item>       <item>*</item>       <item>*    IF ( sy-subrc EQ 0 ).</item>       <item>*      MOVE-CORRESPONDING ls_shipment_cdata TO cs_postab.</item>       <item>*    ENDIF.</item>       <item>*</item>       <item>*******************
****************************************************</item>       <item>** FIN GAPSD021 - Campos Z VL10C Packaging</item>       <item>***********************************************************************</item>       <item>*</item>       <item>*  CASE s
y-tcode.</item>       <item>*    WHEN &apos;VL10X&apos;.</item>       <item>**     add jtm 14.11.2022</item>       <item>*      select SINGLE lgnum into @data(lgnum) from t320 where werks eq @cs_postab-werks.</item>       <item>*      if lgnum is not INIT
IAL.</item>       <item>**        Cambio calculo stock disponible. Cliente + sin asignar - picking</item>       <item>*          CALL FUNCTION &apos;ZSWM_CALCULO_STOCK_DISPONIBLE&apos;</item>       <item>*            EXPORTING</item>       <item>*
      lgnum               = lgnum</item>       <item>*              matnr               = cs_postab-matnr</item>       <item>*              werks               = CS_POSTAB-werks</item>       <item>*            IMPORTING</item>       <item>*              Z
ZLASBT_STOCK       = CS_POSTAB-zzlasbt_stock</item>       <item>*                    .</item>       <item>*      else.</item>       <item>**     fin de add jtm 14.11.2022</item>       <item>*        IF cs_postab-vbelv IS INITIAL.</item>       <item>*
      SELECT SUM( kalab ) into @data(l_mska) FROM mska WHERE matnr = @cs_postab-matnr</item>       <item>*                                                              AND werks = @cs_postab-werks.</item>       <item>*        ELSE.</item>       <item>*
        SELECT SUM( kalab ) into @l_mska FROM mska WHERE matnr = @cs_postab-matnr</item>       <item>*                                                        AND vbeln = @cs_postab-vbelv</item>       <item>*
        AND posnr = @cs_postab-posnv</item>       <item>*                                                        AND werks = @cs_postab-werks.</item>       <item>*        ENDIF.</item>       <item>**     add jtm 14.11.2022 subimos aqui este código</item>
      <item>*      IF sy-subrc = 0 AND l_mska IS NOT INITIAL.</item>       <item>*        cs_postab-zzlasbt_stock = l_mska.</item>       <item>*      ELSE.</item>       <item>*         SELECT SINGLE * INTO @DATA(l_mard) FROM mard where matnr = @cs_postab-
matnr AND werks = @cs_postab-werks.</item>       <item>*        If sy-subrc = 0.</item>       <item>*          cs_postab-zzlasbt_stock = l_mard-labst.</item>       <item>*        ENDIf.</item>       <item>*      ENDIF.</item>       <item>*      endif. &qu
ot; add jtm 14.11.2022</item>       <item>**     fin de subir jtm 14.11.2022 codigo</item>       <item>*    WHEN OTHERS.</item>       <item>*      SELECT SINGLE kalab into @l_mska FROM mska WHERE matnr = @cs_postab-matnr AND vbeln = @cs_postab-vbelv AND p
osnr = @cs_postab-posnv AND werks = @cs_postab-werks.</item>       <item>**     add jtm 14.11.2022 subimos aqui este código</item>       <item>*       IF sy-subrc = 0 AND l_mska IS NOT INITIAL.</item>       <item>*</item>       <item>*         cs_postab-z
zlasbt_stock = l_mska.</item>       <item>*       ELSE.</item>       <item>*          SELECT SINGLE * INTO l_mard FROM mard where matnr = cs_postab-matnr AND werks = cs_postab-werks.</item>       <item>*         If sy-subrc = 0.</item>       <item>*
     cs_postab-zzlasbt_stock = l_mard-labst.</item>       <item>*         ENDIf.</item>       <item>*       ENDIF.</item>       <item>**     fin de subir jtm 14.11.2022 codigo</item>       <item>*</item>       <item>*  ENDCASE.</item>       <item>** del j
tm 14.11.2022</item>       <item>**  IF sy-subrc = 0 AND l_mska IS NOT INITIAL.</item>       <item>**</item>       <item>**    cs_postab-zzlasbt_stock = l_mska.</item>       <item>**  ELSE.</item>       <item>**     SELECT SINGLE * INTO @DATA(l_mard) FROM
 mard where matnr = @cs_postab-matnr AND werks = @cs_postab-werks.</item>       <item>**    If sy-subrc = 0.</item>       <item>**      cs_postab-zzlasbt_stock = l_mard-labst.</item>       <item>**    ENDIf.</item>       <item>**  ENDIF.</item>       <ite
m>** del jtm 14.11.2022</item>       <item>*</item>       <item>**  CONVERSION DE STOCK A M2</item>       <item>*</item>       <item>*  CALL FUNCTION &apos;MD_CONVERT_MATERIAL_UNIT&apos;</item>       <item>*    EXPORTING</item>       <item>*      i_matnr
             = cs_postab-matnr</item>       <item>*      i_in_me              = cs_postab-meins</item>       <item>*      i_out_me             = &apos;M2&apos;</item>       <item>*      i_menge              = cs_postab-labst</item>       <item>*    IMPORT
ING</item>       <item>*      e_menge              = cs_postab-zzlabst_m2</item>       <item>*    EXCEPTIONS</item>       <item>*      error_in_application = 1</item>       <item>*      error                = 2</item>       <item>*      others
   = 3.</item>       <item>*  IF sy-subrc = 0.</item>       <item>*    cs_postab-zzm2 = &apos;M2&apos;.</item>       <item>*  ELSE.</item>       <item>*    CLEAR: cs_postab-zzlabst_m2,cs_postab-zzm2.</item>       <item>*  ENDIF.</item>       <item>*</item
>       <item>*</item>       <item>*  &quot;JVM - 17/11/2022 Añadir el nombre del cliente, no el del destino</item>       <item>*  SELECT SINGLE name1</item>       <item>*    FROM kna1</item>       <item>*    INTO cs_postab-zznom_cli</item>       <item>*
   WHERE kunnr eq ( SELECT kunnr</item>       <item>*                       FROM vbak</item>       <item>*                      WHERE vbeln eq cs_postab-VBELV ).</item>       <item>*  &quot;FJVM - 17/11/2022 Añadir el nombre del cliente, no el del destino
</item>       <item>*</item>       <item>*</item>       <item>***********--&gt; FIN FCC 80366 - Nuevos campos VL10 PAP &quot;Comento lógica antigua para separar PAPEL y CARTÓN</item>       <item/>      </SOURCE>      <PARENT_FULL_NAME/>     </ENH_HOOK_IMP
L>     <ENH_HOOK_IMPL>      <SPOTNAME/>      <PROGRAMNAME>SAPLV50R_VIEW</PROGRAMNAME>      <EXTID>2</EXTID>      <ID>2</ID>      <OVERWRITE/>      <METHOD/>      <ENHMODE>S</ENHMODE>      <FULL_NAME>\PR:SAPLV50R_VIEW\FO:POS_ITEM_FILL_USER\SE:BEGIN\EI</FUL
L_NAME>      <SOURCE>       <item>*</item>       <item>CLEAR cs_postab-zzsegcal_desc.</item>       <item>SELECT SINGLE zzsegcal INTO cs_postab-zzsegcal from vbak where vbeln = is_vbak-vbeln.</item>       <item>IF sy-subrc eq 0.</item>       <item>SELECT S
INGLE texto FROM ztsd0004 INTO cs_postab-zzsegcal_desc WHERE zzsegal = cs_postab-zzsegcal AND spras = sy-langu.</item>       <item>ENDIF.</item>       <item/>      </SOURCE>      <PARENT_FULL_NAME/>     </ENH_HOOK_IMPL>    </IMPLS>   </asx:values>  </asx:
abap> </ENHO>
