<?xml version="1.0" encoding="utf-8"?> <ENHO enhancement_id="ZEHP604_RM07MLBS_23" shorttext="Campos nuevos bobina / cartoncillo - Leer datos" tooltype_id="HOOK_IMPL" orig_object="R3TR-RM07MLBS-PROG-RM07MLBS">  <asx:abap xmlns:asx="http://www.sap.com/abapx
ml" version="1.0">   <asx:values>    <IMPLS>     <ENH_HOOK_IMPL>      <SPOTNAME>ES_RM07MLBS</SPOTNAME>      <PROGRAMNAME>RM07MLBS</PROGRAMNAME>      <EXTID>1</EXTID>      <ID>1</ID>      <OVERWRITE/>      <METHOD/>      <ENHMODE>D</ENHMODE>      <FULL_NAM
E>\PR:RM07MLBS\EX:EHP604_RM07MLBS_23\EI</FULL_NAME>      <SOURCE>       <item>DATA: l_atwtb   TYPE atwtb,</item>       <item>lt_tvarvc TYPE TABLE OF tvarvc WITH HEADER LINE.</item>       <item>* ini 26.01.2018 - cvivo - 46105 Campos adicionales MB52, cara
cterísticas lote</item>       <item>SELECT * FROM tvarvc INTO TABLE lt_tvarvc</item>       <item>WHERE name EQ &apos;ZMM_FIELDS_MB52&apos;.</item>       <item>* fin 26.01.2018 - cvivo - 46105 Campos adicionales MB52, características lote</item>       <ite
m>*   seleccionar los valores de los campos añadidos</item>       <item>LOOP AT bestand.</item>       <item>SELECT SINGLE zzcalidad zzgramaje zzancho zzlargo</item>       <item>INTO CORRESPONDING FIELDS OF bestand</item>       <item>FROM mara</item>
 <item>WHERE matnr EQ bestand-matnr.</item>       <item>IF sy-subrc = 0.</item>       <item>MODIFY bestand.</item>       <item>ENDIF.</item>       <item/>       <item>SELECT SINGLE bezei</item>       <item>INTO bestand-bezei</item>       <item>FROM ztmm00
02t</item>       <item>WHERE zzcalidad = bestand-zzcalidad</item>       <item>AND spras = sy-langu.</item>       <item>IF sy-subrc = 0.</item>       <item>MODIFY bestand.</item>       <item>ENDIF.</item>       <item/>       <item>SELECT SINGLE wgbez wgbez
60</item>       <item>INTO (bestand-wgbez, bestand-wgbez60)</item>       <item>FROM t023t</item>       <item>WHERE matkl = bestand-matkl</item>       <item>AND spras = sy-langu.</item>       <item>IF sy-subrc = 0.</item>       <item>MODIFY bestand.</item>
       <item>ENDIF.</item>       <item/>       <item>CLEAR l_atwtb.</item>       <item>CALL FUNCTION &apos;Z_ZMM008_MATERIAL_COLOR&apos;</item>       <item>EXPORTING</item>       <item>i_matnr       = bestand-matnr</item>       <item>IMPORTING</item>
  <item>*       e_atwrt       =</item>       <item>e_atwtb       = l_atwtb.</item>       <item/>       <item>IF l_atwtb IS NOT INITIAL.</item>       <item>bestand-zzcolor = l_atwtb.</item>       <item>MODIFY bestand TRANSPORTING zzcolor.</item>       <ite
m>ENDIF.</item>       <item/>       <item>* ini 26.01.2018 - cvivo - 46105 Campos adicionales MB52, características lote</item>       <item>DATA: lv_object            TYPE objnum,</item>       <item>lv_classnum          TYPE bapi1003_key-classnum,</item>
      <item>lt_alloc_values_num  TYPE tt_bapi1003_alloc_values_num,</item>       <item>lt_alloc_values_curr TYPE tt_bapi1003_alloc_values_curr,</item>       <item>lt_alloc_values_char TYPE tt_bapi1003_alloc_values_char,</item>       <item>ls_alloc_values_
char TYPE bapi1003_alloc_values_char,</item>       <item>lt_return            TYPE bapiret2_tab,</item>       <item>lv_value             TYPE atwtb.</item>       <item/>       <item>READ TABLE lt_tvarvc WITH KEY low = bestand-werks TRANSPORTING NO FIELDS.
</item>       <item/>       <item>IF sy-subrc EQ 0 AND bestand-charg IS NOT INITIAL.</item>       <item>* Se descarta esta vía por rendimiento</item>       <item>*</item>       <item>*      CLEAR: lv_object, lv_classnum.</item>       <item>*      REFRESH:
 lt_alloc_values_num, lt_alloc_values_char, lt_alloc_values_curr, lt_return.</item>       <item>*</item>       <item>*      CONCATENATE bestand-matnr bestand-charg INTO lv_object.</item>       <item>*</item>       <item>*      IF bestand-mtart = &apos;ZPM
P&apos;.</item>       <item>*        lv_classnum = &apos;Z_ZPMP&apos;.</item>       <item>*      ELSEIF bestand-mtart = &apos;ZPLP&apos;.</item>       <item>*        lv_classnum = &apos;Z_ZPLP&apos;.</item>       <item>*      ENDIF.</item>       <item>*</
item>       <item>*      CALL FUNCTION &apos;BAPI_OBJCL_GETDETAIL&apos;</item>       <item>*        EXPORTING</item>       <item>*          objectkey       = lv_object</item>       <item>*          objecttable     = &apos;MCH1&apos;</item>       <item>*
        classnum        = lv_classnum</item>       <item>*          classtype       = &apos;023&apos;</item>       <item>*        TABLES</item>       <item>*          allocvaluesnum  = lt_alloc_values_num</item>       <item>*          allocvalueschar = lt
_alloc_values_char</item>       <item>*          allocvaluescurr = lt_alloc_values_curr</item>       <item>*          return          = lt_return.</item>       <item>*</item>       <item>*      CLEAR ls_alloc_values_char.</item>       <item>*      READ TA
BLE lt_alloc_values_char INTO ls_alloc_values_char</item>       <item>*             WITH KEY charact = &apos;Z_RECH_PROD&apos;.</item>       <item>*      IF sy-subrc EQ 0.</item>       <item>*        bestand-z_rech_prod = ls_alloc_values_char-value_char.<
/item>       <item>*      ENDIF.</item>       <item>*</item>       <item>*      CLEAR ls_alloc_values_char.</item>       <item>*      READ TABLE lt_alloc_values_char INTO ls_alloc_values_char</item>       <item>*             WITH KEY charact = &apos;Z_DEV
OLUCION&apos;.</item>       <item>*      IF sy-subrc EQ 0.</item>       <item>*        bestand-z_devolucion = ls_alloc_values_char-value_char.</item>       <item>*      ENDIF.</item>       <item/>       <item>* Se opta por consulta directa a tabla por ren
dimiento</item>       <item/>       <item>CALL FUNCTION &apos;Z_ZMM008_DEVOLUCION_LOTE&apos;</item>       <item>EXPORTING</item>       <item>i_matnr       = bestand-matnr</item>       <item>i_charg       = bestand-charg</item>       <item>IMPORTING</item>
       <item>e_atwtb       = lv_value.</item>       <item/>       <item>WRITE lv_value TO bestand-z_devolucion.</item>       <item>CLEAR lv_value.</item>       <item/>       <item>CALL FUNCTION &apos;Z_ZMM008_RECH_PROD_LOTE&apos;</item>       <item>EXPORT
ING</item>       <item>i_matnr       = bestand-matnr</item>       <item>i_charg       = bestand-charg</item>       <item>IMPORTING</item>       <item>e_atwtb       = lv_value.</item>       <item/>       <item>WRITE lv_value TO bestand-z_rech_prod.</item>
      <item>CLEAR lv_value.</item>       <item/>       <item>MODIFY bestand TRANSPORTING z_rech_prod z_devolucion.</item>       <item>ENDIF.</item>       <item>* fin 26.01.2018 - cvivo - 46105 Campos adicionales MB52, características lote</item>       <it
em>* ini 08.05.2019 - cvivo - 54261</item>       <item>DATA: zzE_TDIFF LIKE TVRO-FAHZTD.</item>       <item>CLEAR: bestand-z_antig, zzE_TDIFF.</item>       <item/>       <item>*--&gt; FCC 78976 - Error información antigüedad (0).</item>       <item/>
  <item>IF ( bestand-ersda IS NOT INITIAL AND bestand-ersda NE &apos;00000000&apos; ).</item>       <item>bestand-z_lwedt = bestand-ersda.</item>       <item>ELSE.</item>       <item/>       <item>SELECT SINGLE MAX( budat_mkpf )</item>       <item>FROM ms
eg</item>       <item>INTO bestand-z_lwedt</item>       <item>WHERE charg EQ bestand-charg</item>       <item>AND bwart EQ &apos;101&apos;.</item>       <item/>       <item>ENDIF.</item>       <item/>       <item>*&lt;-- FCC 78976 - Error información anti
güedad (0).</item>       <item/>       <item>CALL FUNCTION &apos;SD_CALC_DURATION_FROM_DATETIME&apos;</item>       <item>EXPORTING</item>       <item>i_date1 = bestand-z_lwedt &quot; ULTIMA EM</item>       <item>i_time1 = SY-UZEIT          &quot; HORA ACT
UAL</item>       <item>i_Date2 = SY-DATUM          &quot; FECHA ACTUAL</item>       <item>i_time2 = SY-UZEIT          &quot; HORA ACTUAL</item>       <item>IMPORTING</item>       <item>E_TDIFF                = zzE_TDIFF</item>       <item>*      E_DATE2_E
ARLY          =</item>       <item>EXCEPTIONS</item>       <item>INVALID_DATETIME       = 1</item>       <item>OTHERS                 = 2</item>       <item>.</item>       <item>IF SY-SUBRC = 0.</item>       <item>bestand-z_antig = ( zzE_TDIFF / 240000 ).
</item>       <item>ENDIF.</item>       <item/>       <item>MODIFY bestand TRANSPORTING z_antig z_lwedt.</item>       <item>* fin 08.05.2019 - cvivo - 54261</item>       <item/>       <item>* ini 27.08.2019 - cvivo - 56683 Incluir proveedor en ZRMM0012</i
tem>       <item>if bestand-zzlifnr is INITIAL.</item>       <item>SELECT SINGLE lifnr licha FROM mch1</item>       <item>INTO ( bestand-zzlifnr, bestand-zzlicha ) &quot; cvivo - 66422</item>       <item>WHERE matnr EQ bestand-matnr</item>       <item>AND
 charg EQ bestand-charg.</item>       <item/>       <item>IF sy-subrc = 0.</item>       <item>MODIFY bestand TRANSPORTING zzlifnr.</item>       <item>ENDIF.</item>       <item>endif.</item>       <item>* fin 27.08.2019 - cvivo - 56683</item>       <item/>
       <item>ENDLOOP.</item>       <item/>       <item/>      </SOURCE>      <PARENT_FULL_NAME/>     </ENH_HOOK_IMPL>    </IMPLS>   </asx:values>  </asx:abap> </ENHO>
