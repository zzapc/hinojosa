<?xml version="1.0" encoding="utf-8"?> <ENHO enhancement_id="ZZLVKMP001" shorttext="Exit para re determinación de riesgo" tooltype_id="HOOK_IMPL" orig_object="R3TR-VKMP-FUGR-SAPLVKMP">  <asx:abap xmlns:asx="http://www.sap.com/abapxml" version="1.0">   <as
x:values>    <IMPLS>     <ENH_HOOK_IMPL>      <SPOTNAME/>      <PROGRAMNAME>SAPLVKMP</PROGRAMNAME>      <EXTID>1</EXTID>      <ID>1</ID>      <OVERWRITE/>      <METHOD/>      <ENHMODE>D</ENHMODE>      <FULL_NAME>\PR:SAPLVKMP\FO:BEDINGUNG_PRUEFEN_001\SE:EN
D\EI</FULL_NAME>      <SOURCE>       <item>* SI YA ESTA LIBERADO EL PEDIDO SE  EVITA QUE SE VUELVA A REDTERMINAR</item>       <item>***if xvbak-vkorg eq &apos;2001&apos; AND SY-TCODE EQ &apos;VA02&apos; AND XVBUK-CMPSA EQ &apos;B&apos;.</item>       <item
>*** MOVE CHARX TO BYPASS-DYNAMIC_LIMIT.</item>       <item>*** MOVE CHARX TO STATUS_RESET-STATIC_LIMIT.</item>       <item>***endif.</item>       <item>***</item>       <item>***&quot;ASC &gt;&gt;&gt; 04.03.24 No verificar por segunda vez el crédito</ite
m>       <item>***DATA: lv_aufnr    TYPE aufnr,</item>       <item>***      ls_jest     TYPE jest,</item>       <item>***      ls_jest2    TYPE jest,</item>       <item>***      lv_objnr    TYPE j_objnr,</item>       <item>***      lt_afpo     type CCRCTT
_AFPO,</item>       <item>***      lt_log      TYPE TABLE OF zssdt_log_cred,</item>       <item>***      ls_log      TYPE zssdt_log_cred.</item>       <item>***</item>       <item>***  LOOP AT xvbap[] INTO DATA(ls_vbap).</item>       <item>***    SELECT *
</item>       <item>***        INTO table lt_afpo</item>       <item>***        FROM afpo</item>       <item>***        WHERE kdauf =  ls_vbap-vbeln</item>       <item>***          AND kdpos EQ ls_vbap-posnr.</item>       <item>***    LOOP AT lt_afpo INTO
 DATA(ls_afpo).</item>       <item>***      CONCATENATE &apos;OR&apos; ls_afpo-aufnr INTO lv_objnr.</item>       <item>***</item>       <item>***      clear ls_log.</item>       <item>***      ls_log-vbeln = ls_vbap-vbeln.</item>       <item>***      ls_l
og-posnr = ls_vbap-posnr.</item>       <item>***      ls_log-aufnr = ls_vbap-aufnr.</item>       <item>***      ls_log-objnr = lv_objnr.</item>       <item>***      ls_log-aedat = sy-datum.</item>       <item>***      ls_log-aezet = sy-timlo.</item>
 <item>***      ls_log-aenam = sy-uname.</item>       <item>***</item>       <item>***      SELECT SINGLE *</item>       <item>***        FROM jest</item>       <item>***        INTO ls_jest</item>       <item>***        WHERE objnr = lv_objnr</item>
  <item>***          AND stat  = &apos;I0002&apos;</item>       <item>***          AND inact = &apos;&apos;</item>       <item>***          AND NOT EXISTS ( SELECT *</item>       <item>***                              FROM jest</item>       <item>***
                         WHERE objnr = lv_objnr</item>       <item>***                                AND stat = &apos;I0076&apos;</item>       <item>***                                AND inact = &apos;&apos; ).</item>       <item>***      IF sy-subrc EQ
 0.</item>       <item>***        ls_log-static_limit  = abap_true.</item>       <item>***        status_reset-static_limit = &apos;X&apos;.</item>       <item>***      ENDIF.</item>       <item>***</item>       <item>***      SELECT SINGLE low FROM tvarv
c INTO @data(lv_activo) WHERE name = &apos;Z_SD_STATIC_LIMIT_LOG&apos;</item>       <item>***                                                            AND type = &apos;P&apos;.</item>       <item>***      IF sy-subrc = 0 AND lv_activo = abap_true.</item
>       <item>***        MODIFY zssdt_log_cred FROM ls_log.</item>       <item>***      ENDIF.</item>       <item>***    ENDLOOP.</item>       <item>***  ENDLOOP.</item>       <item/>       <item>&quot;ASC &lt;&lt;&lt; 04.03.24 No verificar por segunda ve
z el crédito</item>       <item/>      </SOURCE>      <PARENT_FULL_NAME/>     </ENH_HOOK_IMPL>     <ENH_HOOK_IMPL>      <SPOTNAME/>      <PROGRAMNAME>SAPLVKMP</PROGRAMNAME>      <EXTID>2</EXTID>      <ID>2</ID>      <OVERWRITE/>      <METHOD/>      <ENHMO
DE>D</ENHMODE>      <FULL_NAME>\PR:SAPLVKMP\FO:BEDINGUNG_PRUEFEN_001\SE:BEGIN\EI</FULL_NAME>      <SOURCE>       <item/>       <item>*if xvbak-vkorg eq &apos;2001&apos; AND SY-TCODE EQ &apos;VA02&apos; AND XVBUK-CMPSA EQ &apos;B&apos;.</item>       <item>
* MOVE CHARX TO BYPASS-DYNAMIC_LIMIT.</item>       <item>* MOVE CHARX TO STATUS_RESET-STATIC_LIMIT.</item>       <item>*endif.</item>       <item/>       <item>&quot;ASC &gt;&gt;&gt; 04.03.24 No verificar por segunda vez el crédito</item>       <item>DATA
: lv_aufnr    TYPE aufnr,</item>       <item>ls_jest     TYPE jest,</item>       <item>ls_jest2    TYPE jest,</item>       <item>lv_objnr    TYPE j_objnr,</item>       <item>lt_afpo     type CCRCTT_AFPO,</item>       <item>lt_log      TYPE TABLE OF zssdt_
log_cred,</item>       <item>ls_log      TYPE zssdt_log_cred.</item>       <item/>       <item>LOOP AT xvbap[] INTO DATA(ls_vbap).</item>       <item>SELECT *</item>       <item>INTO table lt_afpo</item>       <item>FROM afpo</item>       <item>WHERE kdau
f =  ls_vbap-vbeln</item>       <item>AND kdpos EQ ls_vbap-posnr.</item>       <item>LOOP AT lt_afpo INTO DATA(ls_afpo).</item>       <item>CONCATENATE &apos;OR&apos; ls_afpo-aufnr INTO lv_objnr.</item>       <item/>       <item>clear ls_log.</item>
 <item>ls_log-vbeln = ls_vbap-vbeln.</item>       <item>ls_log-posnr = ls_vbap-posnr.</item>       <item>ls_log-aufnr = ls_afpo-aufnr.</item>       <item>ls_log-objnr = lv_objnr.</item>       <item>ls_log-aedat = sy-datum.</item>       <item>ls_log-aezet
= sy-timlo.</item>       <item>ls_log-aenam = sy-uname.</item>       <item/>       <item>SELECT SINGLE *</item>       <item>FROM jest</item>       <item>INTO ls_jest</item>       <item>WHERE objnr = lv_objnr</item>       <item>AND stat  = &apos;I0002&apos
;</item>       <item>AND inact = &apos;&apos;</item>       <item>AND NOT EXISTS ( SELECT *</item>       <item>FROM jest</item>       <item>WHERE objnr = lv_objnr</item>       <item>AND stat = &apos;I0076&apos;</item>       <item>AND inact = &apos;&apos; )
.</item>       <item>IF sy-subrc EQ 0.</item>       <item>ls_log-static_limit  = abap_true.</item>       <item>status_reset-static_limit = &apos;X&apos;.</item>       <item>bypass-static_limit       = &apos;X&apos;.</item>       <item>ENDIF.</item>
<item/>       <item>SELECT SINGLE low FROM tvarvc INTO @data(lv_activo) WHERE name = &apos;Z_SD_STATIC_LIMIT_LOG&apos;</item>       <item>AND type = &apos;P&apos;.</item>       <item>IF sy-subrc = 0 AND lv_activo = abap_true.</item>       <item>MODIFY zss
dt_log_cred FROM ls_log.</item>       <item>ENDIF.</item>       <item>ENDLOOP.</item>       <item>ENDLOOP.</item>       <item/>      </SOURCE>      <PARENT_FULL_NAME/>     </ENH_HOOK_IMPL>    </IMPLS>   </asx:values>  </asx:abap> </ENHO>
