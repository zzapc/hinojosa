*&---------------------------------------------------------------------*
*& Include J_3RMOBVEDTOP                                               *
*&---------------------------------------------------------------------*

PROGRAM j_3rmobved LINE-COUNT 65(2)
    MESSAGE-ID /ccis/scmim NO STANDARD PAGE HEADING.

ENHANCEMENT-POINT j_3rmobvedtop_g4 SPOTS es_j_3rmobved STATIC .

ENHANCEMENT-POINT j_3rmobvedtop_g5 SPOTS es_j_3rmobved.

ENHANCEMENT-POINT j_3rmobvedtop_g6 SPOTS es_j_3rmobved STATIC .

ENHANCEMENT-POINT j_3rmobvedtop_g7 SPOTS es_j_3rmobved.

TYPE-POOLS: slis, j3rm.

TABLES:
  t001,                                                     "1666710
  t001w,                                                    "1666710
  t001k,                                                    "1666710
  ska1,
  mard,
  t134,
  t023,
  t148,
  mbew,
  mara,
  marc,
  bsim,
  mska,
  msku,
  mslb,
  prps,
  mcha,
  indx.
*    t030
*    .

TYPES:
  type_gazprvl      TYPE bbuchhw,
  type_gazprst      TYPE beszug,
  type_check_box(1) TYPE c,
  type_1c(1)        TYPE c,
  type_text70(70)   TYPE c,
  type_link(63)     TYPE c,
  type_tblsb(4)     TYPE c,
  type_tab(83)      TYPE c,

  type_listmat      TYPE j_3rmlistmatw,
  type_alv_listmat  TYPE j_3rmlistmat,
  type_docmat       TYPE j_3rmlistdokw,
  type_alv_docmat   TYPE j_3rmlistdok,

  BEGIN OF type_field_list1,
    lt_listfield1(72) TYPE c,
  END OF type_field_list1,
  BEGIN OF type_field_list2,
    lt_listfield2(72) TYPE c,
  END OF type_field_list2,
  BEGIN OF type_matnr_struc,
    matnr TYPE matnr,
  END OF type_matnr_struc,
  BEGIN OF type_select_bwkey,
    bwkey TYPE bwkey,
  END OF type_select_bwkey,

  BEGIN OF type_field_link,
    low TYPE  type_link,
  END OF type_field_link,

  BEGIN OF type_where_in_werks,
    sign   TYPE sign,
    option TYPE option,
    low    TYPE werks_d,
    high   TYPE werks_d,
  END OF type_where_in_werks,

  BEGIN OF type_where_in_sobkz,
    sign   TYPE sign,
    option TYPE option,
    low    TYPE sobkz,
    high   TYPE sobkz,
  END OF type_where_in_sobkz,
  BEGIN OF type_where_in_pstyp,
    sign   TYPE sign,
    option TYPE option,
    low    TYPE pstyp,
    high   TYPE pstyp,
  END OF type_where_in_pstyp,
  BEGIN OF type_where_in_elikz,
    sign   TYPE sign,
    option TYPE option,
    low    TYPE elikz,
    high   TYPE elikz,
  END OF type_where_in_elikz,
  BEGIN OF type_where_in_loekz,
    sign   TYPE sign,
    option TYPE option,
    low    TYPE eloek,
    high   TYPE eloek,
  END OF type_where_in_loekz,

  BEGIN OF type_period_key,
    lfgja TYPE lfgja,
    lfmon TYPE lfmon,
  END OF type_period_key,
  BEGIN OF type_matnr_key,
    matnr TYPE matnr,
    werks TYPE werks_d,
    lgort TYPE lgort_d,
  END OF type_matnr_key,
  BEGIN OF type_matnr_keysobkz,
    matnr TYPE matnr,
    werks TYPE werks_d,
    charg TYPE charg_d,
    sobkz TYPE sobkz,
  END OF type_matnr_keysobkz,
  BEGIN OF type_matnr_keylsobkz,
    matnr TYPE matnr,
    werks TYPE werks_d,
    lgort TYPE lgort_d,
    charg TYPE charg_d,
    sobkz TYPE sobkz,
  END OF type_matnr_keylsobkz,

  BEGIN OF type_way_matnr, " for function 'MB_ADD_TRANSFER_QUANTITY'
    werks TYPE werks_d,
    matnr TYPE matnr,
    menge TYPE menge_d,
    meins TYPE meins,
    dmbtr TYPE dmbtr,
    waers TYPE waers,
    netwr TYPE bwert,
    bwaer TYPE waers,
    ebeln TYPE ebeln,
    ebelp TYPE ebelp,
    sobkz TYPE sobkz,
    pstyp TYPE pstyp,
    bstmg TYPE menge_d,
    bstme TYPE meins,
    reswk TYPE reswk,
  END OF type_way_matnr,
  BEGIN OF type_marc,
    matnr TYPE matnr,
    werks TYPE werks_d,
    bwtty TYPE bwtty_d,  " valuation category
    bwkey TYPE bwkey,
    xchar TYPE xchar,  " batch management indicato(internal)
    trame TYPE trame,  " stock in transit
    umlmc TYPE umlme,  " stock in transfer (plant to plant)
    bwesb TYPE bwesb,  " ERP 2005 Valuated Goods Receipt Blocked stock
    meins TYPE meins,
    mtart TYPE mtart,
    matkl TYPE matkl,
    bismt TYPE bismt,
    maktx TYPE maktx,
  END OF type_marc,
  BEGIN OF type_mssq,
    matnr TYPE matnr,
    werks TYPE werks_d,
    sobkz TYPE sobkz,
    pspnr TYPE ps_psp_pnr,
    bwkey TYPE bwkey,
    bwtty TYPE bwtty_d,
    xchar TYPE xchar,
    sqtra TYPE sqtra,
    mtart TYPE mtart,                                       "1418079
    matkl TYPE matkl,                                       "1418079
    bismt TYPE bismt, " old material number                "1157518
    maktx TYPE maktx,
  END OF type_mssq,
  BEGIN OF type_mssa,
    matnr TYPE matnr,
    werks TYPE werks_d,
    sobkz TYPE sobkz,
    vbeln TYPE vbeln,
    posnr TYPE posnr,
    bwkey TYPE bwkey,
    bwtty TYPE bwtty_d,
    xchar TYPE xchar,
    satra TYPE satra,
    mtart TYPE mtart,                                       "1418079
    matkl TYPE matkl,                                       "1418079
    bismt TYPE bismt, " old material number                "1157518
    maktx TYPE maktx,
  END OF type_mssa,
  BEGIN OF type_t163k,
    knttp TYPE knttp,
    kzvbr TYPE ekvbr,
  END OF type_t163k,
  BEGIN OF type_mard_mara,
    matnr     TYPE matnr,
    werks     TYPE werks_d,
    lgort     TYPE lgort_d,
    bwkey     TYPE bwkey,
    labst     TYPE labst, " Valuated stock with unrestricted use
* Stock in transfer (from one storage location to another)
    umlme     TYPE umlmd,
    insme     TYPE insme, " Stock in quality inspection
    einme     TYPE einme, " Total Stock of All Restricted Batches
    speme     TYPE speme, " Blocked stock
    retme     TYPE retme, " Blocked Stock Returns
    klabs     TYPE klabs, " Unrestricted-use consignment stock
    kinsm     TYPE kinsm, " Consignment stock in quality inspection
    keinm     TYPE keinm, " Restricted-use consignment stock
    kspem     TYPE kspem, " Blocked consignment stock
    meins     TYPE meins, " Base Unit of Measure
    mtart     TYPE mtart, " material type
    matkl     TYPE matkl, " material group
    bismt     TYPE bismt, " Old material number
    xchar     TYPE xchar, " batch management indicator (internal)
    trame     TYPE trame, " stock in transit
    umlmc     TYPE umlme, " stock in transfer (plant to plant)
    bwesb     TYPE bwesb,  " Valuated Goods Receipt Blocked Stock
    bwtty     TYPE bwtty_d, " valuation category
    ekgrp     TYPE ekgrp, " purchasing group
    sobkz     TYPE sobkz, " special stock type
    speci     TYPE labst, " Valuated stock with unrestricted use
    vbeln     TYPE vbeln, " Sales and Distribution Document Number
    posnr     TYPE posnr, " Item number of the SD document
* Work Breakdown Structure Element (WBS Element)
    pspnr     TYPE ps_psp_pnr,
    sortl     TYPE partid, " Partner ID
* valuation table sign "MBEW", "EBEW" "QBEW"
    tblsb     TYPE type_tblsb,
    charg     TYPE charg_d,
* stock in intransfer with transport order relation = 'X'
    trord     TYPE xchar,
    maktx     TYPE maktx,
    xchar_del TYPE xchar, " deleted indicator (internal)   "1114541
  END OF type_mard_mara,
  BEGIN OF type_mard_marah.
        INCLUDE TYPE type_period_key.
        INCLUDE TYPE type_matnr_key.
TYPES:
  bwkey TYPE bwkey,
  labst TYPE labst, " Valuated stock with unrestricted use
  umlme TYPE umlme,
  insme TYPE insme, " Stock in quality inspection
  einme TYPE einme, " Total Stock of All Restricted Batches
  speme TYPE speme, " Blocked stock
  retme TYPE retme, " Blocked Stock Returns
  vklab TYPE vklab,
  vkuml TYPE vkuml,
  END OF type_mard_marah,
  BEGIN OF type_xbew,
    matnr TYPE matnr,
    bwkey TYPE bwkey,
    bwtar TYPE bwtar_d,  " valuation type
    bwtty TYPE bwtty_d,  " Valuation Category
    lbkum TYPE lbkum,    " Total valuated stock
    salk3 TYPE salk3,    " Value of total valuated stock
    bklas TYPE bklas,    " Valuation Class
    vprsv TYPE vprsv,    " Price Control Indicator S/V
    stprs TYPE stprs,    " Standard Price
    peinh TYPE peinh,    " Price Unit
* Cost Estimate Number - Product Costing
    kaln1 TYPE ck_kalnr1,
* Sales and Distribution Document Number
    vbeln TYPE vbeln,
    posnr TYPE posnr,    " Item number of the SD document
* Work Breakdown Structure Element (WBS Element)
    pspnr TYPE ps_psp_pnr,
    sobkz TYPE sobkz,    " Special Stock Indicator
  END OF type_xbew,
  BEGIN OF type_xbewh.
        INCLUDE TYPE type_period_key.
        INCLUDE TYPE type_xbew.
TYPES:
END OF type_xbewh,

BEGIN OF type_bsim_mseg_mkpf,
  mblnr TYPE mblnr,
  mjahr TYPE mjahr,
  bwkey TYPE bwkey,
  bwtar TYPE bwtar_d,
  dmbtr TYPE dmbtr,
  menge TYPE menge_d,
  shkzg TYPE shkzg,
  bwart TYPE bwart,
  bustm TYPE bustm,
  bdatf TYPE budat,
  bdatm TYPE budat,
  matnr TYPE matnr,
  werks TYPE werks_d,
  lgort TYPE lgort_d,
  charg TYPE charg_d,
  umwrk TYPE umwrk,
  zeile TYPE mblpo,
  kunnr TYPE kunnr,
  lifnr TYPE lifnr,
  vbeln TYPE vbeln,
  posnr TYPE posnr,    " Item number of the SD document
* Work Breakdown Structure Element (WBS Element)
  pspnr TYPE ps_psp_pnr,
  sobkz TYPE sobkz,    " Special Stock Indicator
  count TYPE i,
END OF type_bsim_mseg_mkpf,
BEGIN OF type_bsim_mseg_here,
  mblnr TYPE mblnr,
  mjahr TYPE mjahr,
  bwkey TYPE bwkey,
  bwtar TYPE bwtar_d,
  lgort TYPE lgort_d,
  matnr TYPE matnr,
  sobkz TYPE sobkz,
  vbeln TYPE vbeln,
  posnr TYPE posnr,
  pspnr TYPE ps_psp_pnr,
  zeile TYPE mblpo,
  shkzg TYPE shkzg,
  menge TYPE menge_d,
END OF type_bsim_mseg_here,
BEGIN OF type_msku,
  matnr TYPE matnr,
  werks TYPE werks_d,
  bwkey TYPE bwkey,
  charg TYPE charg_d,
  sobkz TYPE sobkz,
  kunnr TYPE kunnr,
  lfgja TYPE lfgja,
  lfmon TYPE lfmon,
  kuspr TYPE sperr,
  kulab TYPE labst,
  kuins TYPE insme,
  kuvla TYPE vmlab,
  kuvin TYPE vmins,
  meins TYPE meins,
  mtart TYPE mtart, " material type
  matkl TYPE matkl, " material group
  xchar TYPE xchar,
  ekgrp TYPE ekgrp, " purchasing group
  bismt TYPE bismt, " old material number                "1157518
  maktx TYPE maktx,
END OF type_msku,
BEGIN OF type_mskuh.
        INCLUDE TYPE type_period_key.
        INCLUDE TYPE type_matnr_keysobkz.
TYPES:
  bwkey TYPE bwkey,
  kunnr TYPE kunnr,
  kulab TYPE labst,
  kuins TYPE insme,
  kuvin TYPE einme,
  END OF type_mskuh,
  BEGIN OF type_mslb,
    matnr TYPE matnr,
    werks TYPE werks_d,
    bwkey TYPE bwkey,
    charg TYPE charg_d,
    sobkz TYPE sobkz,
    lifnr TYPE lifnr,
    lblab TYPE labst,
    lbins TYPE insme,
    meins TYPE meins,
    mtart TYPE mtart, " material type
    matkl TYPE matkl, " material group
    xchar TYPE xchar,
    ekgrp TYPE ekgrp, " purchasing group
    bismt TYPE bismt, " old material number                "1157518
    maktx TYPE maktx,
  END OF type_mslb,
  BEGIN OF type_mslbh.
        INCLUDE TYPE type_period_key.
        INCLUDE TYPE type_matnr_keysobkz.
TYPES:
  lifnr TYPE lifnr,
  lblab TYPE labst,
  lbins TYPE insme,
  lbein TYPE einme,
  END OF type_mslbh,
  BEGIN OF type_mska,
    matnr TYPE matnr,
    werks TYPE werks_d,
    bwkey TYPE bwkey,
    lgort TYPE lgort_d,
    charg TYPE charg_d,
    sobkz TYPE sobkz,
    vbeln TYPE vbeln,
    posnr TYPE posnr,
    kalab TYPE labst,
    kains TYPE insme,
    kaspe TYPE speme,
    meins TYPE meins,
    mtart TYPE mtart, " material type
    matkl TYPE matkl, " material group
    xchar TYPE xchar,
    ekgrp TYPE ekgrp, " purchasing group
    bismt TYPE bismt, " old material number                "1157518
    maktx TYPE maktx,
  END OF type_mska,
  BEGIN OF type_mskah.
        INCLUDE TYPE type_period_key.
        INCLUDE TYPE type_matnr_keylsobkz.
TYPES:
  vbeln TYPE vbeln,
  posnr TYPE posnr,
  kalab TYPE labst,
  kains TYPE insme,
  kaspe TYPE speme,
  kaein TYPE einme,
  END OF type_mskah,
  BEGIN OF type_mspr,
    matnr TYPE matnr,
    werks TYPE werks_d,
    bwkey TYPE bwkey,
    lgort TYPE lgort_d,
    charg TYPE charg_d,
    sobkz TYPE sobkz,
    pspnr TYPE ps_psp_pnr,
    prlab TYPE labst,
    prins TYPE insme,
    prspe TYPE speme,
    prein TYPE einme,
    meins TYPE meins,
    mtart TYPE mtart, " material type
    matkl TYPE matkl, " material group
    xchar TYPE xchar,
    ekgrp TYPE ekgrp, " purchasing group
    bismt TYPE bismt, " old material number                "1157518
    maktx TYPE maktx,
  END OF type_mspr,
  BEGIN OF type_msprh.
        INCLUDE TYPE type_period_key.
        INCLUDE TYPE type_matnr_keylsobkz.
TYPES:
  pspnr TYPE ps_psp_pnr,
  prlab TYPE labst,
  prins TYPE insme,
  prspe TYPE speme,
  prein TYPE einme,
  END OF type_msprh,
  BEGIN OF type_156,
    bwart TYPE bwart,
    kzvbu TYPE kzvbu,
    kzstr TYPE kzstr,
  END OF type_156,
  BEGIN OF type_156n,
    fcode      TYPE fcode,
    bwart      TYPE bwart,
    bwart_next TYPE bwart,
    xstor      TYPE kzsto,
  END OF type_156n,
  BEGIN OF type_156st,
    bwart      TYPE bwart,
    bwart_next TYPE bwart,
  END OF type_156st,
  BEGIN OF type_bustm,
    bustm TYPE bustm,
    lbbsa TYPE lbbsa,
    kbbsa TYPE kbbsa,
  END OF type_bustm,
  BEGIN OF type_matnr_way,
    bukrs TYPE bukrs,   " CC
    matnr TYPE matnr,
    bwkey TYPE bwkey,
    lgort TYPE lgort_d,
    sobkz TYPE sobkz,
    vbeln TYPE vbeln,
    posnr TYPE posnr,
    pspnr TYPE ps_psp_pnr,
  END OF type_matnr_way,
  BEGIN OF type_select_lgort,
    matnr TYPE matnr,
    werks TYPE werks_d,
    lgort TYPE lgort_d,
  END OF type_select_lgort,
  BEGIN OF type_select_charg,
    matnr TYPE matnr,
    werks TYPE werks_d,
    charg TYPE charg_d,
  END OF type_select_charg,
  BEGIN OF type_skb1,
    bukrs TYPE bukrs,
    saknr TYPE saknr,
  END OF type_skb1,
  BEGIN OF type_cost,
    matnr      TYPE matnr,      " material number
    bwkey      TYPE bwkey,      " valuation area
    bwtar      TYPE bwtar_d,    " valuation type
    bwtty      TYPE bwtty_d,    " valuation category
    werks      TYPE werks_d,    " plants
    tblsb      TYPE type_tblsb,      " special stock valuation type
    sobkz      TYPE sobkz,      " special stock
    lgort      TYPE lgort_d,      " storage
    charg      TYPE charg_d,      " storage
    linkk      TYPE type_link, " index field
    subkey(20) TYPE c,          " project/customer order/customer
    salkbfact  TYPE type_gazprvl, " stock cost on beginning of period
    salkefact  TYPE type_gazprvl, " stock cost on ending of period
    salkb      TYPE type_gazprvl,     " stock cost on beginning of period
    salke      TYPE type_gazprvl,     " stock cost on ending of period
    lbkub      TYPE type_gazprst, " quant.of stock on beginning of period
    lbkue      TYPE type_gazprst, " quant.of stock on ending of period
    peinh      TYPE peinh,  " multiplier cost
    kaln1      TYPE ck_kalnr1,
    vbeln      TYPE vbeln,
    posnr      TYPE posnr,    " Item number of the SD document
* Work Breakdown Structure Element (WBS Element)
    pspnr      TYPE ps_psp_pnr,
    salk3      TYPE type_gazprvl,
    lbkum      TYPE type_gazprst,
  END OF type_cost,
  BEGIN OF type_mcha_mchb,
    matnr TYPE matnr,     " materail number
    bwtar TYPE bwtar_d,     " valuation type
    werks TYPE werks_d,     " plant
    lgort TYPE lgort_d,     " Storage Location
    charg TYPE charg_d,     " Batch Number
* Valuated stock with unrestricted use
    clabs TYPE labst,
* Stock in transfer (from one storage location to another)
    cumlm TYPE umlmd,
    cinsm TYPE insme,     " Stock in quality inspection
    cspem TYPE speme,     " Blocked stock
* Total Stock of All Restricted Batches
    ceinm TYPE einme,
  END OF type_mcha_mchb,
  BEGIN OF type_mcha,
    matnr   TYPE matnr,     " materail number
    werks   TYPE werks_d,     " plant
    bwtar   TYPE bwtar_d,     " Valuation Type
    charg   TYPE charg_d,     " Batch Number
    changed TYPE c,           " N(ew)/O(ld) val. type    "1247791
  END OF type_mcha,
  BEGIN OF type_hide_field,
    xbukrs       TYPE bukrs,   " CC
    xbwkey       TYPE bwkey,
    xgjahr       TYPE gjahr,   " document year
    xhkont       TYPE hkont,   " GL account
    bvorg        TYPE bvorg,
    later(1)     TYPE c,      " this is sign - BUDAT > so_budat-HIGH
    overvalue(1) TYPE c,  " the document is overvalue
    incld(1)     TYPE c,      " o?uouoyo o?oEy o n?u?y?o y? ?uu?oo
    deleted(1)   TYPE c,
    invoice(1)   TYPE c,  " the document is invoice
    pricvar(1)   TYPE c,  " price variance
    notrights(1) TYPE c,  " document permission banner
    tblsb        TYPE type_tblsb, " valuated type table (MBEW, EBEW, QBEW)
  END OF type_hide_field,

* valuation type change doc. and its history                   "1247791
  BEGIN OF type_bwtar_change,                               "1247791
    mblnr      TYPE mblnr,
    mjahr      TYPE mjahr,
    zeile      TYPE mblpo,
    matnr      TYPE matnr,
    bwkey      TYPE bwkey,
    bwtar      TYPE bwtar_d,
    werks      TYPE werks_d,
    lgort      TYPE lgort_d,
    charg      TYPE charg_d,
    sobkz      TYPE sobkz,
    linkk      TYPE j_3rmanylink,
    date       TYPE budat,
    time       TYPE cputm,
    lbkum      TYPE lbkum,
    begremn    TYPE j_3rfbrm,
    endremn    TYPE j_3rferm,
    deltlbkumd TYPE j_3rfgores,
    deltlbkumk TYPE j_3rfgoiss,
    menge      TYPE menge_d,
  END OF type_bwtar_change,                                 "1247791

  BEGIN OF type_overval,
    field_link TYPE type_link.
        INCLUDE TYPE j_3rmlistdok.
        INCLUDE TYPE type_hide_field.
TYPES:
  sjahr        TYPE mjahr,  " canceled document year
  smbln        TYPE mblnr,  " canceled document number
  sjhnr        TYPE mjahr,  " canceled doc. year search streeng
  sblnr        TYPE mblnr,  " canceled doc. number search streeng
  nprei        TYPE nprei,  " new price
  peinh        TYPE peinh,  " price unit
  lbkumcurrent TYPE type_gazprst,
  lbkumcommon  TYPE type_gazprst,
  lost         TYPE type_1c,
  END OF type_overval,
  BEGIN OF type_bsim_bkpf,
    matnr TYPE matnr,
    bwkey TYPE bwkey,
    bwtar TYPE bwtar_d,
    belnr TYPE belnr_d,
    gjahr TYPE gjahr,
    bukrs TYPE bukrs,
    stblg TYPE stblg,
    stjah TYPE stjah,
    buzei TYPE buzei,
    bvorg TYPE bvorg,
    menge TYPE menge_d,
    shkzg TYPE shkzg,
    meins TYPE meins,
    dmbtr TYPE dmbtr,
    budat TYPE budat,
    cpudt TYPE cpudt,
    cputm TYPE cputm,
    buzid TYPE buzid,
    awtyp TYPE awtyp,
    blart TYPE blart,
    awkey TYPE awkey,
    xblnr TYPE xblnr,
    waers TYPE waers,
    monat TYPE monat,
    vbel2 TYPE vbeln_va,
    posn2 TYPE posnr_va,
    projk TYPE ps_psp_pnr,
    awkbl TYPE belnr_d,
    awkgj TYPE gjahr,
  END OF type_bsim_bkpf,
*    begin of type_bsim_bkpf1.
*        include type: type_bsim_bkpf.
*types:
*        cputm type cputm,
*        cpudt type cpudt,
*    end of type_bsim_bkpf1,
  BEGIN OF type_bseg,
    bukrs TYPE bukrs,
    belnr TYPE belnr_d,
    gjahr TYPE gjahr,
    buzei TYPE buzei,
    shkzg TYPE shkzg,
    dmbtr TYPE dmbtr,
    wrbtr TYPE wrbtr,
    ktosl TYPE ktosl,
    bwtar TYPE bwtar_d,
    bwkey TYPE bwkey,
    werks TYPE werks_d,
    nprei TYPE nprei,
    peinh TYPE peinh,
    hkont TYPE hkont,
    ebeln TYPE ebeln,
    ebelp TYPE ebelp,
    matnr TYPE matnr,
    menge TYPE menge_d,
    lifnr TYPE lifnr,
    kunnr TYPE kunnr,
    vbeln TYPE vbeln_vf,                                    "1932440
    vbel2 TYPE vbeln_va,
    posn2 TYPE posnr_va,
    projk TYPE ps_psp_pnr,
  END OF type_bseg,
  BEGIN OF type_bkpf,
    bukrs TYPE bukrs,
    belnr TYPE belnr_d,
    gjahr TYPE gjahr,
    awtyp TYPE awtyp,
    awkey TYPE awkey,
    budat TYPE budat,
  END OF type_bkpf,
  BEGIN OF type_mseg_mkpf,
    mblnr      TYPE mblnr,
    mjahr      TYPE mjahr,
    zeile      TYPE mblpo,
    menge      TYPE menge_d,
    meins      TYPE meins,
    bpmng      TYPE bpmng,
    bprme      TYPE bprme,
    dmbtr      TYPE dmbtr,
    salk3      TYPE salk3_mseg,
    lbkum      TYPE lbkum_mseg,
    kostl      TYPE kostl,
    lifnr      TYPE elifn,
    anln1      TYPE anln1,
    kunnr      TYPE ekunn,
    umwrk      TYPE umwrk,
    umlgo      TYPE umlgo,
    umcha      TYPE umcha,
    umbar      TYPE umbar,
    aufnr      TYPE aufnr,
    ebeln      TYPE bstnr,
    ebelp      TYPE ebelp,
    sakto      TYPE saknr,
    werks      TYPE werks_d,
    lgort      TYPE lgort_d,
    bwart      TYPE bwart,
    matnr      TYPE matnr,
    shkzg      TYPE shkzg,
    sjahr      TYPE mjahr,
    smbln      TYPE mblnr,
    smblp      TYPE mblpo,
    bwtar      TYPE bwtar_d,
    bukrs      TYPE bukrs,
    waers      TYPE waers,
    belnr      TYPE belnr_d,
    gjahr      TYPE gjahr,
    buzei      TYPE buzei,
    xblnr      TYPE xblnr,
    vgart      TYPE vgart,
    budat      TYPE budat,
    cpudt      TYPE cpudt,
    cputm      TYPE cputm,
    kzbew      TYPE kzbew,
    kzvbr      TYPE kzvbr,
    kzzug      TYPE kzzug,
    xauto      TYPE mb_xauto,
    sobkz      TYPE sobkz,
    wertu      TYPE wertu,
    mengu      TYPE mengu,
    charg      TYPE charg_d,
    kdauf      TYPE kdauf,
    kdpos      TYPE kdpos,
    ps_psp_pnr TYPE ps_psp_pnr,
    bustm      TYPE bustm,
    bustw      TYPE bustw,
    vprsv      TYPE vprsv,
    awkey      TYPE awkey,
    wrbtr      TYPE wrbtr,
    separ(1)   TYPE c,
    charg_del  TYPE charg_d,     " deleted batch number     "1114541
  END OF type_mseg_mkpf,
*    begin of type_mseg_mkpf1.
*        include type type_mseg_mkpf.
*types:
*        cputm type cputm,
*        cpudt type cpudt,
*    end of type_mseg_mkpf1,
  BEGIN OF type_acctit,
    awtyp     TYPE awtyp,
    awref     TYPE awref,
    aworg     TYPE aworg,
    posnr     TYPE posnr_acc,
    kstat     TYPE kstaz,   " ?????
    bukrs     TYPE bukrs,
    belnr     TYPE belnr_d,
    gjahr     TYPE gjahr,
    budat     TYPE budat,                                   "1091464
    vorgn     TYPE vorgn,
    prvrg_sv  TYPE prvrg_sv,
    ktosl     TYPE ktosl,
    bschl     TYPE bschl,
    shkzg     TYPE shkzg,
    pswbt     TYPE pswbt,
    koart     TYPE koart,
    matnr     TYPE matnr,
    menge     TYPE menge_d,
    werks     TYPE werks_d,
    bwart     TYPE bwart,
    buzid     TYPE buzid,
    sobkz     TYPE sobkz,
    bwkey     TYPE bwkey,
    bwtar     TYPE bwtar_d,
    xbilk     TYPE xbilk,   " ?????
    xmfrw     TYPE xmfrw,
    kzuml     TYPE kzuml,
    zeile     TYPE ck_zeile,
    hkont     TYPE hkont,
    mat_kdauf TYPE mat_kdauf,
    mat_kdpos TYPE mat_kdpos,
    mat_pspnr TYPE mat_pspnr,
  END OF type_acctit,
  BEGIN OF type_ekbe,
    ebeln TYPE ebeln,
    ebelp TYPE ebelp,
    vgabe TYPE vgabe,
    bewtp TYPE bewtp,
    belnr TYPE mblnr,
    buzei TYPE mblpo,
    gjahr TYPE gjahr,
    werks TYPE werks_d,
    matnr TYPE matnr,
    menge TYPE menge_d,
    shkzg TYPE shkzg,
    dmbtr TYPE dmbtr,
    bwtar TYPE bwtar_d,
    bwart TYPE bwart,
    awkey TYPE awkey,
  END OF type_ekbe,
  BEGIN OF type_key_bseg,
    belnr TYPE belnr_d,
    buzei TYPE buzei,
    bukrs TYPE bukrs,
    gjahr TYPE gjahr,
  END OF type_key_bseg,

**********************************************************************
*SAP Note 2392907
  BEGIN OF type_mlit_mlcrf,

    bukrs    TYPE bukrs,

    belnr    TYPE ck_belnr,
    kjahr    TYPE ck_kjahr,

    poper    TYPE poper,

    matnr    TYPE matnr,
    bwkey    TYPE bwkey,
    bwtar    TYPE bwtar_d,

    vbeln    TYPE vbeln,
    posnr    TYPE posnr,
    pspnr    TYPE ps_psp_pnr,

    prdif    TYPE ck_prdif,
    krdif    TYPE ck_krdif,

    fi_found TYPE flag,

  END OF type_mlit_mlcrf,
**********************************************************************

  BEGIN OF type_mseg_pos,
    mblnr TYPE mblnr,
    mjahr TYPE mjahr,
    zeile TYPE mblpo,
    matnr TYPE matnr,
    werks TYPE werks_d,
    lgort TYPE lgort_d,
  END OF type_mseg_pos,
  BEGIN OF type_mseg,
    mblnr      TYPE mblnr,
    mjahr      TYPE mjahr,
    matnr      TYPE matnr,
    werks      TYPE werks_d,
    lgort      TYPE lgort_d,
    zeile      TYPE mblpo,
    bwart      TYPE bwart,
    bwtar      TYPE bwtar_d,
    charg      TYPE charg_d,
    shkzg      TYPE shkzg,
    menge      TYPE menge_d,
    dmbtr      TYPE dmbtr,
    waers      TYPE waers,
    salk3      TYPE salk3_mseg,
    lbkum      TYPE lbkum_mseg,
    kostl      TYPE kostl,
    lifnr      TYPE elifn,
    anln1      TYPE anln1,
    kunnr      TYPE ekunn,
    umwrk      TYPE umwrk,
    umlgo      TYPE umlgo,
    aufnr      TYPE aufnr,
    ebeln      TYPE bstnr,
    ebelp      TYPE ebelp,
    sakto      TYPE saknr,
    sjahr      TYPE mjahr,
    smbln      TYPE mblnr,
    smblp      TYPE mblpo,
    sobkz      TYPE sobkz,
    wertu      TYPE wertu,
    mengu      TYPE mengu,
    bustm      TYPE bustm,
    bustw      TYPE bustw,
    vprsv      TYPE vprsv,
    kdauf      TYPE kdauf,
    kdpos      TYPE kdpos,
    ps_psp_pnr TYPE ps_psp_pnr,
  END OF type_mseg,
  BEGIN OF type_mkpf,
    mblnr TYPE mblnr,
    mjahr TYPE mjahr,
    xblnr TYPE xblnr,
    budat TYPE budat,
    bldat TYPE bldat,
  END OF type_mkpf,
  BEGIN OF type_key_mseg,
    mblnr TYPE mblnr,
    mjahr TYPE mjahr,
    menge TYPE menge_d,
    werks TYPE werks_d,
    matnr TYPE matnr,
    awtyp TYPE awtyp,
    aworg TYPE aworg,
    bwtar TYPE bwtar_d,
  END OF type_key_mseg,
  BEGIN OF type_key_ekbe,
    ebeln TYPE ebeln,
    ebelp TYPE ebelp,
    matnr TYPE matnr,
  END OF type_key_ekbe,
  BEGIN OF type_key_rbkp,
    bukrs TYPE bukrs,
    belnr TYPE belnr_d,
  END OF type_key_rbkp,
  BEGIN OF type_key_mlit,
    belnr TYPE ck_belnr,
    kjahr TYPE ck_kjahr,
    matnr TYPE matnr,
    poper TYPE poper,
    bwtar TYPE bwtar_d,
    bwkey TYPE bwkey,
    bukrs TYPE bukrs,
    blnrf TYPE belnr_d,
    buzei TYPE buzei,
  END OF type_key_mlit,
  BEGIN OF type_bkpf_rbkp,
    bukrs TYPE bukrs,
    belnr TYPE belnr_d,
    gjahr TYPE gjahr,
    stblg TYPE stblg,
    stjah TYPE stjah,
    awtyp TYPE awtyp,
    awkey TYPE awkey,
    tcode TYPE tcode,
    firbk TYPE re_belnr,
    fijhr TYPE gjahr,
    stblr TYPE re_stblg,
    stjar TYPE re_stjah,
  END OF type_bkpf_rbkp,
  BEGIN OF type_rbkp,
    belnr TYPE re_belnr,
    gjahr TYPE gjahr,
    vgart TYPE m8vga,
    stblg TYPE re_stblg,
    stjah TYPE re_stjah,
  END OF type_rbkp,
  BEGIN OF type_kdauf,
    kdauf TYPE vbeln_va,
    kdpos TYPE posnr_va,
  END OF type_kdauf,
  BEGIN OF type_xblnr,
    xblnr TYPE mblnr,
  END OF type_xblnr,
  BEGIN OF type_partners_sale,
    vbeln TYPE vbeln,
    parvw TYPE parvw,
    kunnr TYPE kunnr,
    name1 TYPE name1_gp,
    vtweg TYPE vtweg,
  END OF type_partners_sale,
  BEGIN OF type_ebeln,
    ebeln TYPE ebeln,
    ebelp TYPE ebelp,
  END OF type_ebeln,
  BEGIN OF type_ebeln1,
    matnr TYPE matnr,
    ebeln TYPE ebeln,
    ebelp TYPE ebelp,
  END OF type_ebeln1,
  BEGIN OF type_partners_pay1,
    ebeln TYPE ebeln,
    ebelp TYPE ebelp,
    mfrnr TYPE mfrnr,
    name1 TYPE name1_gp,
  END OF type_partners_pay1,
  BEGIN OF type_partners_pay2,
    ebeln TYPE ebeln,
    lifnr TYPE elifn,
    name1 TYPE name1_gp,
  END OF type_partners_pay2,
  BEGIN OF type_werks_from,
    ebeln TYPE ebeln,
    reswk TYPE reswk,
  END OF type_werks_from,
  BEGIN OF type_routers,
    mblnr   TYPE mblnr,
    vbtyp_v TYPE vbtyp_v,
    route   TYPE route,
    vtweg   TYPE vtweg,
  END OF type_routers,
  BEGIN OF type_routers1,
    vbelv TYPE vbeln_von,
    posnv TYPE posnr_von,
    route TYPE route,
  END OF type_routers1,
  BEGIN OF type_bsim_pos,
    matnr TYPE matnr,
    bwkey TYPE bwkey,
    bwtar TYPE bwtar_d,
    belnr TYPE belnr_d,
    gjahr TYPE gjahr,
    buzei TYPE buzei,
  END OF type_bsim_pos,
  BEGIN OF type_erase_storno,
    matnr TYPE matnr,                                       "2097423
    gjahr TYPE gjahr,         " reversl document year
    mblnr TYPE mblnr,         " reversl document number
    zeile TYPE mblpo,         " reversl document item
    sjahr TYPE mjahr,         " canceled document year
    smbln TYPE mblnr,         " canceled document number
    smblp TYPE mblpo,         " canceled document item
    lgort TYPE lgort_d,
  END OF type_erase_storno,
  BEGIN OF type_ekpo,
    ebeln TYPE ebeln,
    ebelp TYPE ebelp,
    matnr TYPE matnr,
    bukrs TYPE bukrs,
    werks TYPE werks_d,
    bwkey TYPE bwkey,
    lgort TYPE lgort_d,
    sobkz TYPE sobkz,
    bwtty TYPE bwtty_d,
    bwtar TYPE bwtar_d,
    charg TYPE charg_d,
    bewtp TYPE bewtp,
    menge TYPE menge_d,
    pstyp TYPE pstyp,
    knttp TYPE knttp,
    shkzg TYPE shkzg,
    umrez TYPE umrez,  "Numerator for Conversion of Order Unit to Base Unit
    umren TYPE umren,  "Denominator for Conversion of Order Unit to Base Unit
  END OF type_ekpo,
  BEGIN OF type_ekkn,
    ebeln      TYPE ebeln,
    ebelp      TYPE ebelp,
    zekkn      TYPE dzekkn,
    loekz      TYPE kloek,
    vbeln      TYPE vbeln_co,
    vbelp      TYPE posnr_co,
    ps_psp_pnr TYPE ps_psp_pnr,
  END OF type_ekkn,
  BEGIN OF type_transfer,
    matnr TYPE matnr,
    werks TYPE werks_d,
    tblsb TYPE type_tblsb,
    sobkz TYPE sobkz,
    linkk TYPE j_3rmanylink,
    bwtar TYPE bwtar_d,
  END OF type_transfer,
  BEGIN OF type_where_in,
    line(72) TYPE c,
  END OF type_where_in,
  BEGIN OF type_bustm_in,
    bustm TYPE bustm,
  END OF type_bustm_in,
  BEGIN OF type_werk_class_saknr,
    werks TYPE werks_d,
    bklas TYPE bklas,         " Valuation Class
    saknr TYPE saknr,
  END OF type_werk_class_saknr,

  tt_listfield1       TYPE STANDARD TABLE OF type_field_list1,
  tt_listfield2       TYPE STANDARD TABLE OF type_field_list2,
  tt_156st            TYPE SORTED TABLE OF type_156st
                 WITH NON-UNIQUE KEY bwart,
  tt_156n             TYPE SORTED TABLE OF type_156n
                  WITH NON-UNIQUE KEY bwart,
  tt_156              TYPE SORTED TABLE OF type_156
                   WITH UNIQUE KEY bwart,
  tt_156_way_in       TYPE SORTED TABLE OF type_bustm       "#EC *
            WITH NON-UNIQUE KEY bustm,                      "#EC *
  tt_156_way_out      TYPE SORTED TABLE OF type_bustm
           WITH NON-UNIQUE KEY bustm,
  tt_mard_mara        TYPE SORTED TABLE OF type_mard_mara
             WITH UNIQUE KEY matnr werks sobkz lgort
                             vbeln posnr pspnr sortl,

  tt_ekpo             TYPE SORTED TABLE OF type_ekpo
                  WITH NON-UNIQUE KEY matnr ebeln ebelp,
  tt_ekkn             TYPE SORTED TABLE OF type_ekkn
                  WITH NON-UNIQUE KEY ebeln ebelp,

  tt_mbew             TYPE SORTED TABLE OF type_xbew
                  WITH NON-UNIQUE KEY matnr bwkey bwtar bwtty,
  tt_ebew             TYPE SORTED TABLE OF type_xbew
                  WITH NON-UNIQUE KEY matnr bwkey bwtar bwtty,
  tt_qbew             TYPE SORTED TABLE OF type_xbew
                  WITH NON-UNIQUE KEY matnr bwkey bwtar bwtty,

  tt_msku             TYPE SORTED TABLE OF type_msku
                  WITH NON-UNIQUE KEY matnr werks charg sobkz kunnr,
  tt_mska             TYPE SORTED TABLE OF type_mska
                  WITH NON-UNIQUE KEY matnr werks,
  tt_mslb             TYPE SORTED TABLE OF type_mslb
                  WITH NON-UNIQUE KEY matnr werks charg sobkz lifnr,
  tt_mspr             TYPE SORTED TABLE OF type_mspr
                  WITH NON-UNIQUE KEY matnr werks lgort charg sobkz pspnr,
  tt_ind1_qbew        TYPE SORTED TABLE OF type_xbew
             WITH NON-UNIQUE KEY matnr pspnr,
  tt_ind1_ebew        TYPE SORTED TABLE OF type_xbew
             WITH NON-UNIQUE KEY matnr vbeln posnr,
  tt_matnr_way        TYPE SORTED TABLE OF type_matnr_way
               WITH UNIQUE KEY bukrs matnr bwkey lgort sobkz
                               vbeln posnr pspnr,
  tt_select_lgort     TYPE SORTED TABLE OF type_select_lgort
          WITH UNIQUE KEY matnr werks lgort,
  tt_select_charg     TYPE SORTED TABLE OF type_select_charg
          WITH UNIQUE KEY matnr werks charg,
  tt_skb1             TYPE SORTED TABLE OF type_skb1
                  WITH NON-UNIQUE KEY bukrs saknr,
  tt_mcha_mchb        TYPE SORTED TABLE OF type_mcha_mchb
             WITH UNIQUE KEY matnr bwtar werks lgort charg,
  tt_mcha             TYPE SORTED TABLE OF type_mcha
                  WITH UNIQUE KEY matnr werks bwtar charg,
  tt_overvalue        TYPE SORTED TABLE OF type_overval
             WITH NON-UNIQUE KEY
                 xbukrs xmatnr xhkont bwtar xbwkey  "tblsb
                 budat xbelnr buzei,
  tt_partcost         TYPE SORTED TABLE OF type_cost
              WITH UNIQUE KEY matnr bwkey bwtar bwtty
                              werks tblsb linkk lgort charg sobkz,
  tt_bsim_bkpf        TYPE STANDARD TABLE OF type_bsim_bkpf "1247791
             WITH NON-UNIQUE KEY bwkey bwtar matnr,
  tt_bwtar_change     TYPE STANDARD TABLE OF type_bwtar_change "1247791
          WITH NON-UNIQUE KEY mblnr mjahr matnr bwtar       "1247791
                              werks lgort charg sobkz linkk, "1247791
  tt_mseg_mkpf        TYPE STANDARD TABLE OF type_mseg_mkpf
             WITH NON-UNIQUE KEY lgort sobkz bwtar werks matnr charg,
  tt_mseg_mkpf_s      TYPE STANDARD TABLE OF type_mseg_mkpf,
  tt_mseg_mkpf_mb     TYPE SORTED TABLE OF type_mseg_mkpf
          WITH NON-UNIQUE KEY mblnr mjahr matnr werks lgort, "1384361
*    tt_mseg_mkpf1 type standard table of type_mseg_mkpf1
*        with non-unique key lgort sobkz bwtar werks matnr,
  tt_mseg_mkpf_m      TYPE SORTED TABLE OF type_mseg_mkpf
           WITH NON-UNIQUE KEY mblnr zeile,
  tt_acctit           TYPE SORTED TABLE OF type_acctit
                WITH NON-UNIQUE KEY
                    awtyp awref bukrs hkont matnr werks sobkz,
  tt_ekbe             TYPE SORTED TABLE OF type_ekbe
                  WITH NON-UNIQUE KEY ebeln ebelp,
  tt_bseg             TYPE SORTED TABLE OF type_bseg
                  WITH UNIQUE KEY
                      buzei belnr bukrs gjahr,
  tt_bseg1            TYPE SORTED TABLE OF type_bseg
                 WITH NON-UNIQUE KEY
                     belnr werks matnr gjahr bukrs shkzg,
  tt_bkpf             TYPE SORTED TABLE OF type_bkpf
                  WITH NON-UNIQUE KEY awkey bukrs,
  tt_key_bseg         TYPE SORTED TABLE OF type_key_bseg
              WITH UNIQUE KEY belnr buzei bukrs gjahr,
  tth_key_bseg        TYPE HASHED TABLE OF type_key_bseg
             WITH UNIQUE KEY belnr buzei bukrs gjahr,
  tt_mlit_mlcrf       TYPE SORTED TABLE OF type_mlit_mlcrf
            WITH NON-UNIQUE KEY belnr kjahr matnr bwkey
                                bukrs poper,
  tt_mseg_pos         TYPE SORTED TABLE OF type_mseg_pos
              WITH NON-UNIQUE KEY mblnr mjahr zeile matnr werks lgort,
  tt_key_ekbe         TYPE SORTED TABLE OF type_key_ekbe
              WITH UNIQUE KEY ebeln ebelp matnr,
  tt_key_mseg         TYPE SORTED TABLE OF type_key_mseg
              WITH UNIQUE KEY mblnr mjahr menge werks matnr bwtar awtyp,
  tt_key_rbkp         TYPE STANDARD TABLE OF type_key_rbkp
              WITH NON-UNIQUE KEY bukrs belnr,
  tt_key_mlit         TYPE STANDARD TABLE OF type_key_mlit
              WITH NON-UNIQUE KEY
              belnr kjahr matnr bwtar bwkey bukrs,
  tt_bkpf_rbkp        TYPE STANDARD TABLE OF type_bkpf_rbkp
             WITH NON-UNIQUE KEY bukrs belnr gjahr,
  tt_bkpf_rbkp1       TYPE SORTED TABLE OF type_bkpf_rbkp   "1860088
            WITH NON-UNIQUE KEY firbk fijhr,
  tt_rbkp             TYPE SORTED TABLE OF type_rbkp
                  WITH NON-UNIQUE KEY belnr gjahr,
  tt_mseg             TYPE STANDARD TABLE OF type_mseg,
  tt_mkpf             TYPE STANDARD TABLE OF type_mkpf,
  tt_kdauf            TYPE SORTED TABLE OF type_kdauf
                 WITH NON-UNIQUE KEY kdauf kdpos,
  tt_partners_sale    TYPE SORTED TABLE OF type_partners_sale
         WITH NON-UNIQUE KEY vbeln parvw,
  tt_ebeln            TYPE SORTED TABLE OF type_ebeln
                 WITH NON-UNIQUE KEY ebeln ebelp,
  tt_partners_pay1    TYPE SORTED TABLE OF type_partners_pay1
         WITH NON-UNIQUE KEY ebeln ebelp,
  tt_partners_pay2    TYPE SORTED TABLE OF type_partners_pay2
         WITH NON-UNIQUE KEY ebeln,
  tt_werks_from       TYPE SORTED TABLE OF type_werks_from
            WITH NON-UNIQUE KEY ebeln,
  tt_routers          TYPE SORTED TABLE OF type_routers
               WITH NON-UNIQUE KEY mblnr vbtyp_v,
  tt_routers1         TYPE SORTED TABLE OF type_routers1
              WITH NON-UNIQUE KEY vbelv posnv,
  tt_xblnr            TYPE SORTED TABLE OF type_xblnr
                 WITH NON-UNIQUE KEY xblnr,
  tt_bsim_pos         TYPE SORTED TABLE OF type_bsim_pos
              WITH UNIQUE KEY
                  buzei belnr bwkey bwtar gjahr matnr,
  tt_ind1_listmat     TYPE SORTED TABLE OF type_listmat
          WITH UNIQUE KEY xmatnr bwtar werk tblsb
                          pspnr vbeln posnr sortl lgort charg sobkz,
  tt_ind2_listmat     TYPE SORTED TABLE OF type_listmat
          WITH NON-UNIQUE KEY xmatnr bwkey bwtar bwtty werk,
  tt_ind3_listmat     TYPE SORTED TABLE OF type_listmat
          WITH NON-UNIQUE KEY xmatnr bwtar werk xsaknr,
  tt_ind4_listmat     TYPE SORTED TABLE OF type_listmat
          WITH UNIQUE KEY field_link,
  tt_ind1_docmat      TYPE SORTED TABLE OF type_docmat
           WITH NON-UNIQUE KEY xmatnr bwtar werk tblsb lgort
                               charg sobkz linkk budat,
  tt_ind2_docmat      TYPE SORTED TABLE OF type_docmat
           WITH NON-UNIQUE KEY xbukrs xbelnr buzei pspnr vbeln posnr,
  tt_ind4_docmat      TYPE SORTED TABLE OF type_docmat
           WITH NON-UNIQUE KEY sjahr sblnr szile lgort,
  tt_ind5_docmat      TYPE SORTED TABLE OF type_docmat
           WITH NON-UNIQUE KEY field_link,
  tt_ind6_docmat      TYPE SORTED TABLE OF type_docmat
           WITH NON-UNIQUE KEY sjahr smbln smblp,
  tt_ind7_docmat      TYPE SORTED TABLE OF type_docmat
           WITH NON-UNIQUE KEY xmatnr bwtar werk tblsb
           pspnr vbeln posnr budat,
  tt_werk_class_saknr TYPE HASHED TABLE OF type_werk_class_saknr
        WITH UNIQUE KEY werks bklas,
  tt_erase_storno     TYPE STANDARD TABLE OF type_erase_storno,
  tt_so_lifnr         TYPE RANGE OF lifnr,
  tt_so_kunnr         TYPE RANGE OF kunnr,
  tt_so_matnr         TYPE RANGE OF matnr,
  tt_so_bwkey         TYPE RANGE OF bwkey,                  "1161322
  tt_so_link          TYPE RANGE OF type_link,
  tt_so_werks         TYPE RANGE OF werks_d,
  tt_so_charg         TYPE RANGE OF charg_d,
  tt_so_bwtar         TYPE RANGE OF bwtar_d,
  tt_so_budat         TYPE RANGE OF budat,
  tt_so_lgort         TYPE RANGE OF lgort_d,
  tt_so_sobkz         TYPE RANGE OF sobkz,
  tt_so_matkl         TYPE RANGE OF matkl,
  tt_so_mtart         TYPE RANGE OF mtart,
  tt_so_vbeln         TYPE RANGE OF vbeln,
  tt_so_posid         TYPE RANGE OF ps_posid,
  tt_so_saknr         TYPE RANGE OF saknr,
  tt_pspnr            TYPE RANGE OF ps_psp_pnr,
  BEGIN OF type_bklas,
    bklas TYPE bklas,
  END OF type_bklas,
  tt_bklas          TYPE STANDARD TABLE OF type_bklas,

  tt_field_link     TYPE STANDARD TABLE OF type_field_link,
  tt_select_bwkey   TYPE SORTED TABLE OF type_select_bwkey
        WITH UNIQUE KEY bwkey,
  tt_select_matnr   TYPE SORTED TABLE OF type_matnr_struc   "1161322
        WITH UNIQUE KEY matnr,                              "1161322
  tt_bsim_mseg_mkpf TYPE SORTED TABLE OF type_bsim_mseg_mkpf
      WITH NON-UNIQUE KEY mblnr mjahr bwkey
                          bwtar dmbtr menge shkzg,
  tt_bustm_in       TYPE HASHED TABLE OF type_bustm_in
            WITH UNIQUE KEY bustm,
  tt_bsim_mseg_here TYPE SORTED TABLE OF type_bsim_mseg_here
          WITH NON-UNIQUE KEY mblnr mjahr bwkey bwtar
             lgort matnr sobkz vbeln posnr pspnr,
  tt_transfer       TYPE HASHED TABLE OF type_transfer
            WITH UNIQUE KEY matnr werks tblsb sobkz linkk bwtar,
  tt_where_in       TYPE STANDARD TABLE OF type_where_in,
  tt_listmat        TYPE STANDARD TABLE OF type_listmat,
  tt_docmat         TYPE STANDARD TABLE OF type_docmat,
  tts_listmat       TYPE SORTED TABLE OF type_listmat       "1318706
            WITH UNIQUE KEY xmatnr ybukrs werk bwkey bwtar lgort charg linkk,
  tt_way_matnr      TYPE STANDARD TABLE OF type_way_matnr,
  tt_marc           TYPE SORTED TABLE OF type_marc
                  WITH NON-UNIQUE KEY matnr werks,
  tt_mssa           TYPE SORTED TABLE OF type_mssa
                  WITH NON-UNIQUE KEY matnr werks sobkz vbeln posnr,
  tt_mssq           TYPE SORTED TABLE OF type_mssq
                  WITH NON-UNIQUE KEY matnr werks sobkz pspnr,
  tt_ekpo_free      TYPE SORTED TABLE OF ekpo               "1107249
             WITH NON-UNIQUE KEY ebeln ebelp.               "1107249

CONSTANTS:
*    gc_sels_screen_status LIKE sy-pfkey VALUE 'SEL_SCREEN_STATUS',
  gc_false       TYPE type_1c VALUE ' ',
  gc_true        TYPE type_1c VALUE 'X',
  gc_symbol_a    TYPE type_1c VALUE 'A',
  gc_symbol_c    TYPE type_1c VALUE 'C',
  gc_symbol_1    TYPE type_1c VALUE '1',
  gc_symbol_0    TYPE type_1c VALUE '0',
  gc_divid       TYPE type_1c VALUE '/',
  g_fourzero(4)  TYPE c VALUE '0000',
  gc_dmshb_zero  TYPE j_3rfinsum VALUE 0,
  gc_mensh_zero  TYPE menge_d VALUE 0,
  gc_str_phantom TYPE lgort_d VALUE '####',
  gc_doc_phantom TYPE belnr_d VALUE  '##########',
  gc_empty_lgort TYPE lgort_d VALUE '    ',
  gc_ktosl       TYPE ktosl VALUE 'BSX',
  gc_kzvbr_v     TYPE ekvbr VALUE 'V',
  gc_kzvbr_p     TYPE ekvbr VALUE 'P',                      "1161196
  gc_kzvbr_e     TYPE ekvbr VALUE 'E',                      "1825272
  gc_value_qbew  TYPE type_tblsb VALUE 'QBEW',
  gc_value_mbew  TYPE type_tblsb VALUE 'MBEW',
  gc_value_ebew  TYPE type_tblsb VALUE 'EBEW',
  gc_blart_pr    TYPE blart VALUE 'PR',                     "#EC *
  gc_blart_ml    TYPE blart VALUE 'ML',
  gc_blart_wa    TYPE blart VALUE 'WA',                     "#EC *
  gc_blart_we    TYPE blart VALUE 'WE',                     "#EC *
  gc_blart_wl    TYPE blart VALUE 'WL',                     "#EC *
  gc_blart_re    TYPE blart VALUE 'RE',                     "#EC *
  gc_parvw_ag    TYPE parvw VALUE 'AG',
  gc_parvw_we    TYPE parvw VALUE 'WE',
  gc_awtyp_rmrp  TYPE awtyp VALUE 'RMRP ',
  gc_awtyp_mkpf  TYPE awtyp VALUE 'MKPF ',
  gc_awtyp_mlhd  TYPE awtyp VALUE 'MLHD ',
*    gc_awtyp_auak  type awtyp VALUE 'AUAK ',
  gc_bustw_wa14  TYPE bustw VALUE 'WA14',                   "1114898
  gc_bustw_wf01  TYPE bustw VALUE 'WF01',                   "1114898
  gc_bustm_me11  TYPE bustm VALUE 'ME11',
  gc_bustm_ma05  TYPE bustm VALUE 'MA05',
  gc_bustm_ma06  TYPE bustm VALUE 'MA06',
  gc_bustm_mar0  TYPE bustm VALUE 'MAR0',
  gc_bustm_mar1  TYPE bustm VALUE 'MAR1',
  gc_bustm_mar2  TYPE bustm VALUE 'MAR2',                   "1345551
  gc_bustm_mar3  TYPE bustm VALUE 'MAR3',                   "1345551
  gc_bustm_mar4  TYPE bustm VALUE 'MAR4',                   "1345551
  gc_bustm_me23  TYPE bustm VALUE 'ME23',                   "1861638
  gc_bustm_me24  TYPE bustm VALUE 'ME24',
  gc_bustm_mau2  TYPE bustm VALUE 'MAU2',                   "1112509
  gc_bustm_mauq  TYPE bustm VALUE 'MAUQ',                   "1161196
  gc_bustm_maue  TYPE bustm VALUE 'MAUE',                   "1161196
  gc_bustm_mau8  TYPE bustm VALUE 'MAU8',                   "1161196
  gc_bustm_mau7  TYPE bustm VALUE 'MAU7',                   "1825272
  gc_bustm_mu00  TYPE bustm VALUE 'MU00',                   "1247791
  gc_bustm_mtra  TYPE bustm VALUE 'MTRA',                   "1374130
  gc_bustm_meu1  TYPE bustm VALUE 'MEU1',                   "1542965
  gc_bustm_meu3  TYPE bustm VALUE 'MEU3',                   "1542965
  gc_bustm_meu4  TYPE bustm VALUE 'MEU4',                   "1542965
  gc_vprsv       TYPE vprsv VALUE 'V',
  gc_vbtyp_j     TYPE vbtyp_v VALUE 'J',
  gc_vbtyp_c     TYPE vbtyp_v VALUE 'C',
  gc_bewtp_u     TYPE ekbe-bewtp VALUE 'U',
  gc_bewtp_e     TYPE ekbe-bewtp VALUE 'E',
  gc_keywerk(10) TYPE c VALUE 'J_3RMOBVED',
  gc_keybukr     TYPE type_1c VALUE 'J',
  gc_shkzg_h     TYPE shkzg VALUE 'H',
  gc_shkzg_s     TYPE shkzg VALUE 'S',
  gc_curtp_10    TYPE curtp VALUE '10',
  gc_spec_e      TYPE sobkz VALUE 'E',
  gc_spec_w      TYPE sobkz VALUE 'W',
  gc_spec_v      TYPE sobkz VALUE 'V',
  gc_spec_o      TYPE sobkz VALUE 'O',
  gc_spec_q      TYPE sobkz VALUE 'Q',
* empty values for binary search.
  sp_vbeln       TYPE vbeln_va  VALUE '          ',
  sp_posnr       TYPE posnr_va  VALUE '000000',
  sp_pspnr       TYPE ps_posnr  VALUE '        ',
  sp_sortl       TYPE kunnr     VALUE '          ',
  sp_charg       TYPE charg_d   VALUE '          ',
*    sp_ebeln       LIKE ekpo-ebeln    VALUE '          ',
*    sp_ebelp       LIKE ekpo-ebelp    VALUE '00000',
* reversal documents color
  s_color_storno TYPE char3     VALUE 'C30',

* where_in constants
  gc_option_cp   TYPE option VALUE 'CP',
  gc_option_eq   TYPE option VALUE 'EQ',
  gc_option_bt   TYPE option VALUE 'BT',
  gc_sign_i      TYPE sign   VALUE 'I',
  gc_sign_star   TYPE type_1c VALUE '*'.

DATA:                                                       "1266509
* max number of attempts to set locks                          "1223911
  gc_wait_nmb TYPE i VALUE 200,                             "1266509
  gv_wan      TYPE c.                                       "1417445

CONSTANTS:
* ALV constants
* items type in the riport
  gc_item_typ_u           TYPE type_1c VALUE 'U',
  gc_item_typ_f           TYPE type_1c VALUE 'F',
  gc_item_typ_s           TYPE type_1c VALUE 'S',
  gc_formname_top_of_page TYPE slis_formname VALUE 'TOP_OF_PAGE',
  gc_formname_end_of_page TYPE slis_formname VALUE 'END_OF_PAGE',
  gc_status_hier          TYPE slis_formname VALUE 'PF_STATUS_HIER',
  gc_status_simp          TYPE slis_formname VALUE 'PF_STATUS_SIMP',
  gc_user_command         TYPE slis_formname VALUE 'DOC_SHOW',
  gc_tabname_header       TYPE slis_tabname  VALUE 'LISTMAT',
  gc_tabname_item         TYPE slis_tabname  VALUE 'DOCMAT',
*    gc_structure_head       like dd02l-tabname value 'J_3RMLISTMAT',
*    gc_structure_items      like dd02l-tabname value 'J_3RMLISTDOK',
  gc_structure_head       TYPE tabname VALUE 'J_3RMLISTMATW',
  gc_structure_items      TYPE tabname VALUE 'J_3RMLISTDOKW',
  gc_save                 TYPE type_1c       VALUE 'A',
* Valuation area = plant
  gc_bwkrs_cus_1          TYPE bwkrs_cus     VALUE '1',
* Valuation area = company code
  gc_bwkrs_cus_3          TYPE bwkrs_cus     VALUE '3'.
*    gc_exit_name            type enhbadiid   value '/CCIS/SCMIM_ENH'.
*"#EC NEEDED

CONSTANTS:                                                  "1247791
  gc_btch_client   LIKE tcuch-kzdch VALUE '2', "batch level  "1247791
  gc_btch_material LIKE tcuch-kzdch VALUE '1',              "1247791
  gc_btch_plant    LIKE tcuch-kzdch VALUE '0'.              "1247791

CONSTANTS:                                                  "1411886
  gc_vgart_input_material LIKE mlhd-vgart VALUE 'MI',
  gc_vgart_input_curtp_ms LIKE mlhd-vgart VALUE 'MC'.

DATA: gt_vgart_excl TYPE RANGE OF mlhd-vgart.               "1411886

CONSTANTS:                                                     "1464432 start
  gc_anfb_einst_aufgel LIKE mlppf-feldg VALUE 'ABO',
  gc_endb_einst_abger  LIKE mlppf-feldg VALUE 'EBEA',
  gc_anfb_mst_aufgel   LIKE mlppf-feldg VALUE 'ABMO',
  gc_endb_mst_abger    LIKE mlppf-feldg VALUE 'EBMA'.

DATA: gt_feldg_sum  TYPE RANGE OF mlppf-feldg.                 "1464432 end

DATA:
  ok_code             TYPE syucomm,                         "#EC NEEDED
  gd_made(10)         TYPE c,
  gt_made(8)          TYPE c,
*    g_sele_button LIKE smp_dyntxt,
*    g_extend      type type_1c,

* Valuation area type:
* 1  Valuation area = plant
* 2  Valuation area = several plants
* 3  Valuation area = company code
  g_bwkrs_cus         TYPE bwkrs_cus,

* ALV variables
  gt_field_hier       TYPE slis_t_fieldcat_alv,
  ws_fieldcat         TYPE slis_fieldcat_alv,
  gt_field_simp       TYPE slis_t_fieldcat_alv,
  gs_keyinfo          TYPE slis_keyinfo_alv,
  gt_sort             TYPE slis_t_sortinfo_alv,
  gt_events           TYPE slis_t_event,
  gt_list_top_of_page TYPE slis_t_listheader,
  gx_variant          TYPE disvariant,
  g_variant           TYPE disvariant,
  g_repid             LIKE sy-repid,
  gs_layout           TYPE slis_layout_alv,

* report save/restore in database variables
  g_not_calc          TYPE type_1c,
  g_ndxkeyalc         TYPE indx_srtfd,
  g_key_memory(40)    TYPE c,
  g_erase             TYPE type_1c,
  g_exit              TYPE type_1c,
  g_noshow            TYPE type_1c,
  g_bkgrd             TYPE sybatch,
  g_dhigh             TYPE d,
  g_dlow              TYPE d,

* time-stamp variables
  g_time_mard_b       TYPE timestampl,                      "#EC NEEDED
  g_time_mard_e       TYPE timestampl,                      "#EC NEEDED
  g_time_msku_b       TYPE timestampl,                      "#EC NEEDED
  g_time_msku_e       TYPE timestampl,                      "#EC NEEDED
  g_time_mslb_b       TYPE timestampl,                      "#EC NEEDED
  g_time_mslb_e       TYPE timestampl,                      "#EC NEEDED
  g_time_mska_b       TYPE timestampl,                      "#EC NEEDED
  g_time_mska_e       TYPE timestampl,                      "#EC NEEDED
  g_time_mspr_b       TYPE timestampl,                      "#EC NEEDED
  g_time_mspr_e       TYPE timestampl,                      "#EC NEEDED
  g_time_mbew_b       TYPE timestampl,                      "#EC NEEDED
  g_time_mbew_e       TYPE timestampl,                      "#EC NEEDED
  g_time_ebew_b       TYPE timestampl,                      "#EC NEEDED
  g_time_ebew_e       TYPE timestampl,                      "#EC NEEDED
  g_time_qbew_b       TYPE timestampl,                      "#EC NEEDED
  g_time_qbew_e       TYPE timestampl,                      "#EC NEEDED
  g_time_mcha_b       TYPE timestampl,                      "#EC NEEDED
  g_time_mcha_e       TYPE timestampl,                      "#EC NEEDED
  g_dt_start          TYPE d,
  g_tm_start          TYPE t,

* BADI reference
  gref_cl_ex_scmim    TYPE REF TO /ccis/if_ex_scmim,
* BADI variables
  gt_matnr            TYPE j3rm_t_matnr,
  gt_sobkz            TYPE j3rm_t_sobkz,
  gt_hkont            TYPE j3rm_t_hkont,
  gt_werks            TYPE j3rm_t_werks,
  gt_lgort            TYPE j3rm_t_lgort,
  gt_bwtar            TYPE j3rm_t_bwtar,
  gt_budat            TYPE j3rm_t_budat,

  custlistmat         TYPE j3rm_t_listmatw,
  custdocmat          TYPE j3rm_t_listdokw.

* ranges
*RANGES:
*    so_pspnr FOR qbew-pspnr,          "#EC *
*    tpstyp FOR ekpo-pstyp  OCCURS 0,  "#EC *
*    telikz FOR ekpo-elikz  OCCURS 0,  "#EC *
*    tloekz FOR ekpo-loekz  OCCURS 0,  "#EC *
*    treswk FOR ekko-reswk  OCCURS 0.  "#EC *


* tables
DATA:
  gso_matnr    TYPE j3rm_t_matnr,
  gt_ekpo_free TYPE tt_ekpo_free,                           "1107249
* selection-screen tables
  seltab_cur   TYPE STANDARD TABLE OF rsparams,
  seltab_new   TYPE STANDARD TABLE OF rsparams,

* two main work tables for ALV usage !!!!!
  listmat      TYPE STANDARD TABLE OF type_listmat
           WITH HEADER LINE,
  docmat       TYPE STANDARD TABLE OF type_docmat
            WITH HEADER LINE.
*    so_charg TYPE tt_so_charg.

DATA:
  gv_mseg_conv  TYPE boole_d,                               "1982947
  gv_acctit_get TYPE boole_d.                               "1782012

FIELD-SYMBOLS <list> TYPE type_listmat. " cvivo
