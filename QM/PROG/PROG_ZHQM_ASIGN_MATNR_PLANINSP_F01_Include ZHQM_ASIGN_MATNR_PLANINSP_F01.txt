*&---------------------------------------------------------------------*
*&  Include           ZHQM_ASIGN_MATNR_PLANINSP_F01
*&---------------------------------------------------------------------*

*&---------------------------------------------------------------------*
*&      Form  INIT_GLOBAL_DATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM init_global_data .

**********************************************************************
* Parámetros locales
**********************************************************************

****** OO

  DATA: lo_exception TYPE REF TO zcx_exception.

**********************************************************************
* Validaciones
**********************************************************************

**********************************************************************
* Lógica
**********************************************************************

****** INIT OO

  TRY.
    go_qm_insplan = NEW zcl_hp_qm_inspection_plan( i_werks = p_werks i_plnnr = p_plnnr i_plnal = p_plnal ).
  CATCH zcx_exception INTO lo_exception.
    WRITE: |'Error:' { lo_exception->if_t100_message~t100key-attr1 }|.
    EXIT.
  ENDTRY.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  SELECT_DATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM select_data.

**********************************************************************
* Parámetros locales
**********************************************************************

****** MATNR RANGE

  DATA: lt_r_matnr TYPE md_range_t_matnr.

**********************************************************************
* Validaciones
**********************************************************************

****** OO IS BOUND

  CHECK go_qm_insplan IS BOUND.

**********************************************************************
* Lógica
**********************************************************************

****** PREPARE DATA

  MOVE-CORRESPONDING s_matnr[] TO lt_r_matnr[].

****** GET MATNR LIST

  gt_matnr = go_qm_insplan->get_matnr_notin_mapl_by_qpart( i_qpart = p_qpart i_r_matnr = lt_r_matnr ).
  IF ( lines( gt_matnr ) LE 0 ).
    WRITE: |'Warning: No se han seleccionado materiales'|.
    EXIT.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EXECUTE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM execute .

**********************************************************************
* Parámetros locales
**********************************************************************

****** TABLES

  DATA: lt_bapiret2 TYPE bapiret2_t.

**********************************************************************
* Validaciones
**********************************************************************

****** OO

  CHECK go_qm_insplan IS BOUND.

****** MATNR LIST

  CHECK lines( gt_matnr ) GT 0.

**********************************************************************
* Lógica
**********************************************************************

****** PREPARE DATA

****** SAVE DATA

  lt_bapiret2 = go_qm_insplan->append_materials_to_mapl( i_t_matnr = gt_matnr i_sttag = p_sttag i_testmode = p_test ).

****** WRITE RESULTS

  LOOP AT lt_bapiret2 INTO DATA(ls_bapiret2).
    WRITE: |{ ls_bapiret2-type }: { ls_bapiret2-message }|.
    SKIP.
  ENDLOOP.

ENDFORM.
